#!/bin/bash
set -e

## Sequenza temporale

### Prime operazioni
echo "Prime operazioni"

echo alfa
ssh alfa sudo sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh alfa sudo sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh alfa sudo ip link set dev eth1 address 00:16:3E:FD:E2:AA
ssh alfa sudo sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
ssh alfa sudo sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
ssh alfa sudo sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
ssh alfa sudo ip link set dev eth1 up
ssh alfa sudo ip address add 169.254.69.30 dev eth1
ssh alfa sudo ip address add 10.0.0.26 dev eth1
ssh alfa sudo ip address add 10.0.0.90 dev eth1
ssh alfa sudo ip address add 10.0.0.58 dev eth1
ssh alfa sudo ip address add 10.0.0.50 dev eth1
ssh alfa sudo ip address add 10.0.0.40 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | ssh alfa sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh alfa sudo ip rule add table ntk
ssh alfa sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.8/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.72/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.16/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.80/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.28/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.92/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.60/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.24/31 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.88/31 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.56/31 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.48/31 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.27/32 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.91/32 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.59/32 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.51/32 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.41/32 table ntk
ssh alfa sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.26
ssh alfa sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.16/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.80/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.28/30 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.92/30 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.60/30 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.24/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.88/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.56/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.27/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.91/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.59/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.51/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.41/32 table ntk

echo beta
ssh beta sudo sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh beta sudo sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh beta sudo ip link set dev eth1 address 00:16:3E:EC:A3:E1
ssh beta sudo sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
ssh beta sudo sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
ssh beta sudo sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
ssh beta sudo ip link set dev eth1 up
ssh beta sudo ip address add 169.254.96.141 dev eth1
ssh beta sudo ip address add 10.0.0.10 dev eth1
ssh beta sudo ip address add 10.0.0.74 dev eth1
ssh beta sudo ip address add 10.0.0.58 dev eth1
ssh beta sudo ip address add 10.0.0.50 dev eth1
ssh beta sudo ip address add 10.0.0.40 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | ssh beta sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh beta sudo ip rule add table ntk
ssh beta sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.16/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.80/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.12/30 table ntk
ssh beta sudo ip route add unreachable 10.0.0.76/30 table ntk
ssh beta sudo ip route add unreachable 10.0.0.60/30 table ntk
ssh beta sudo ip route add unreachable 10.0.0.8/31 table ntk
ssh beta sudo ip route add unreachable 10.0.0.72/31 table ntk
ssh beta sudo ip route add unreachable 10.0.0.56/31 table ntk
ssh beta sudo ip route add unreachable 10.0.0.48/31 table ntk
ssh beta sudo ip route add unreachable 10.0.0.11/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.75/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.59/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.51/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.41/32 table ntk
ssh beta sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.10
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.16/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.80/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.12/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.76/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.60/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.8/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.72/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.56/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.11/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.75/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.59/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.51/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.41/32 table ntk

echo gamma
ssh gamma sudo sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh gamma sudo sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh gamma sudo ip link set dev eth1 address 00:16:3E:5B:78:D5
ssh gamma sudo sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
ssh gamma sudo sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
ssh gamma sudo sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
ssh gamma sudo ip link set dev eth1 up
ssh gamma sudo ip address add 169.254.94.223 dev eth1
ssh gamma sudo ip address add 10.0.0.22 dev eth1
ssh gamma sudo ip address add 10.0.0.86 dev eth1
ssh gamma sudo ip address add 10.0.0.62 dev eth1
ssh gamma sudo ip address add 10.0.0.50 dev eth1
ssh gamma sudo ip address add 10.0.0.40 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | ssh gamma sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh gamma sudo ip rule add table ntk
ssh gamma sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.8/29 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.72/29 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.24/29 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.88/29 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.16/30 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.80/30 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.56/30 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.20/31 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.84/31 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.60/31 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.48/31 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.23/32 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.87/32 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.63/32 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.51/32 table ntk
ssh gamma sudo ip route add unreachable 10.0.0.41/32 table ntk
ssh gamma sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.22
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.23/32 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.87/32 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.63/32 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.51/32 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.41/32 table ntk

echo delta
ssh delta sudo sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh delta sudo sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh delta sudo ip link set dev eth1 address 00:16:3E:1A:C4:45
ssh delta sudo sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
ssh delta sudo sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
ssh delta sudo sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
ssh delta sudo ip link set dev eth1 up
ssh delta sudo ip address add 169.254.253.216 dev eth1
ssh delta sudo ip address add 10.0.0.29 dev eth1
ssh delta sudo ip address add 10.0.0.93 dev eth1
ssh delta sudo ip address add 10.0.0.61 dev eth1
ssh delta sudo ip address add 10.0.0.49 dev eth1
ssh delta sudo ip address add 10.0.0.41 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | ssh delta sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh delta sudo ip rule add table ntk
ssh delta sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.16/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.80/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.24/30 table ntk
ssh delta sudo ip route add unreachable 10.0.0.88/30 table ntk
ssh delta sudo ip route add unreachable 10.0.0.56/30 table ntk
ssh delta sudo ip route add unreachable 10.0.0.30/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.94/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.62/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.50/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.28/32 table ntk
ssh delta sudo ip route add unreachable 10.0.0.92/32 table ntk
ssh delta sudo ip route add unreachable 10.0.0.60/32 table ntk
ssh delta sudo ip route add unreachable 10.0.0.48/32 table ntk
ssh delta sudo ip route add unreachable 10.0.0.40/32 table ntk
ssh delta sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.29
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.16/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.80/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.24/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.88/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.30/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.94/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.62/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.50/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.28/32 table ntk
ssh delta sudo ip route change unreachable 10.0.0.92/32 table ntk
ssh delta sudo ip route change unreachable 10.0.0.60/32 table ntk
ssh delta sudo ip route change unreachable 10.0.0.48/32 table ntk
ssh delta sudo ip route change unreachable 10.0.0.40/32 table ntk

echo mu
ssh mu sudo sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh mu sudo sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh mu sudo ip link set dev eth1 address 00:16:3E:2D:8D:DE
ssh mu sudo sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
ssh mu sudo sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
ssh mu sudo sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
ssh mu sudo ip link set dev eth1 up
ssh mu sudo ip address add 169.254.119.176 dev eth1
ssh mu sudo ip address add 10.0.0.11 dev eth1
ssh mu sudo ip address add 10.0.0.75 dev eth1
ssh mu sudo ip address add 10.0.0.59 dev eth1
ssh mu sudo ip address add 10.0.0.51 dev eth1
ssh mu sudo ip address add 10.0.0.41 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | ssh mu sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh mu sudo ip rule add table ntk
ssh mu sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.24/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.88/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.12/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.76/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.60/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.8/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.72/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.56/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.48/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.10/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.74/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.58/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.50/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.40/32 table ntk
ssh mu sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.11
ssh mu sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.12/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.76/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.60/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.8/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.72/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.56/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.10/32 table ntk
ssh mu sudo ip route change unreachable 10.0.0.74/32 table ntk
ssh mu sudo ip route change unreachable 10.0.0.58/32 table ntk
ssh mu sudo ip route change unreachable 10.0.0.50/32 table ntk
ssh mu sudo ip route change unreachable 10.0.0.40/32 table ntk

### Ingresso di 𝛽 in G𝛾
echo "Ingresso beta in G-gamma"

ssh beta sudo ip route add 169.254.94.223 dev eth1 src 169.254.96.141

ssh gamma sudo ip route add 169.254.96.141 dev eth1 src 169.254.94.223

ssh beta sudo ip netns add entr02
ssh beta sudo ip netns exec entr02 sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh beta sudo ip netns exec entr02 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh beta sudo ip link add dev entr02_eth1 link eth1 type macvlan
ssh beta sudo ip link set dev entr02_eth1 netns entr02
ssh beta sudo ip netns exec entr02 ip link set dev entr02_eth1 address 00:16:3E:8E:91:B9
ssh beta sudo ip netns exec entr02 sysctl net.ipv4.conf.entr02_eth1.rp_filter=0 &>/dev/null
ssh beta sudo ip netns exec entr02 sysctl net.ipv4.conf.entr02_eth1.arp_ignore=1 &>/dev/null
ssh beta sudo ip netns exec entr02 sysctl net.ipv4.conf.entr02_eth1.arp_announce=2 &>/dev/null
ssh beta sudo ip netns exec entr02 ip link set dev entr02_eth1 up
ssh beta sudo ip netns exec entr02 ip address add 169.254.215.29 dev entr02_eth1
ssh beta sudo ip netns exec entr02 ip route add 169.254.94.223 dev entr02_eth1 src 169.254.215.29

ssh gamma sudo ip route add 169.254.215.29 dev eth1 src 169.254.94.223

echo "beta0 in networkspace entr02"
ssh beta sudo ip netns exec entr02 ip rule add table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.16/29 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.80/29 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.12/30 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.76/30 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.60/30 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.8/31 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.72/31 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.56/31 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.48/31 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.11/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.75/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.59/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.51/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.41/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.10/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.74/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.58/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.50/32 table ntk
ssh beta sudo ip netns exec entr02 ip route add unreachable 10.0.0.40/32 table ntk
ssh beta sudo ip route del 10.0.0.0/29 table ntk
ssh beta sudo ip route del 10.0.0.64/29 table ntk
ssh beta sudo ip route del 10.0.0.16/29 table ntk
ssh beta sudo ip route del 10.0.0.80/29 table ntk
ssh beta sudo ip route del 10.0.0.24/29 table ntk
ssh beta sudo ip route del 10.0.0.88/29 table ntk
ssh beta sudo ip route del 10.0.0.12/30 table ntk
ssh beta sudo ip route del 10.0.0.76/30 table ntk
ssh beta sudo ip route del 10.0.0.60/30 table ntk
ssh beta sudo ip route del 10.0.0.8/31 table ntk
ssh beta sudo ip route del 10.0.0.72/31 table ntk
ssh beta sudo ip route del 10.0.0.56/31 table ntk
ssh beta sudo ip route del 10.0.0.48/31 table ntk
ssh beta sudo ip route del 10.0.0.11/32 table ntk
ssh beta sudo ip route del 10.0.0.75/32 table ntk
ssh beta sudo ip route del 10.0.0.59/32 table ntk
ssh beta sudo ip route del 10.0.0.51/32 table ntk
ssh beta sudo ip route del 10.0.0.41/32 table ntk
ssh beta sudo iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.10
ssh beta sudo ip address del 10.0.0.10/32 dev eth1
ssh beta sudo ip address del 10.0.0.74/32 dev eth1
ssh beta sudo ip address del 10.0.0.58/32 dev eth1
ssh beta sudo ip address del 10.0.0.50/32 dev eth1
ssh beta sudo ip address del 10.0.0.40/32 dev eth1
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.16/29 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.80/29 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.12/30 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.76/30 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.60/30 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.8/31 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.72/31 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.56/31 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.48/31 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.11/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.75/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.59/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.51/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.41/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.10/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.74/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.58/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.50/32 table ntk
ssh beta sudo ip netns exec entr02 ip route change unreachable 10.0.0.40/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.8/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.72/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip route add unreachable 10.0.0.16/30 table ntk
ssh beta sudo ip route add unreachable 10.0.0.80/30 table ntk
ssh beta sudo ip route add unreachable 10.0.0.56/30 table ntk
ssh beta sudo ip route add unreachable 10.0.0.20/31 table ntk
ssh beta sudo ip route add unreachable 10.0.0.84/31 table ntk
ssh beta sudo ip route add unreachable 10.0.0.60/31 table ntk
ssh beta sudo ip route add unreachable 10.0.0.48/31 table ntk
ssh beta sudo ip route add unreachable 10.0.0.22/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.86/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.62/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.50/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.40/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.23/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.87/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.63/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.51/32 table ntk
ssh beta sudo ip route add unreachable 10.0.0.41/32 table ntk

echo "beta1 in G-gamma"
(echo; echo "250 ntk_from_00:16:3E:5B:78:D5 # xxx_table_ntk_from_00:16:3E:5B:78:D5_xxx") | ssh beta sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh beta sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.20/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.84/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.60/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh beta sudo ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev eth1
ssh beta sudo ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev eth1
ssh beta sudo ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev eth1
ssh beta sudo ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev eth1
ssh beta sudo ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev eth1
ssh beta sudo ip route change unreachable 10.0.0.23/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.87/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.63/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.51/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.41/32 table ntk
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:5B:78:D5 -j MARK --set-mark 250
ssh beta sudo ip rule add fwmark 250 table ntk_from_00:16:3E:5B:78:D5

(echo; echo "250 ntk_from_00:16:3E:EC:A3:E1 # xxx_table_ntk_from_00:16:3E:EC:A3:E1_xxx") | ssh gamma sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh gamma sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.23/32 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.87/32 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.63/32 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.51/32 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.41/32 table ntk
ssh gamma sudo iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:EC:A3:E1 -j MARK --set-mark 250
ssh gamma sudo ip rule add fwmark 250 table ntk_from_00:16:3E:EC:A3:E1

ssh beta sudo ip address add 10.0.0.23 dev eth1
ssh beta sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.23
ssh beta sudo ip address add 10.0.0.87 dev eth1
ssh beta sudo ip address add 10.0.0.63 dev eth1
ssh beta sudo ip address add 10.0.0.51 dev eth1
ssh beta sudo ip address add 10.0.0.41 dev eth1
ssh beta sudo ip route del 10.0.0.23/32 table ntk
ssh beta sudo ip route del 10.0.0.87/32 table ntk
ssh beta sudo ip route del 10.0.0.63/32 table ntk
ssh beta sudo ip route del 10.0.0.51/32 table ntk
ssh beta sudo ip route del 10.0.0.41/32 table ntk
ssh beta sudo ip route del 10.0.0.23/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route del 10.0.0.87/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route del 10.0.0.63/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route del 10.0.0.51/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route del 10.0.0.41/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.20/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.84/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.60/31 table ntk
ssh beta sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh beta sudo ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
ssh beta sudo ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
ssh beta sudo ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.41
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5

ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh gamma sudo ip route change 10.0.0.23/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.87/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.63/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.51/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change 10.0.0.41/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.40

echo "beta0 dismessa"
ssh beta sudo ip netns exec entr02 ip route flush table main
ssh beta sudo ip netns exec entr02 ip link delete entr02_eth1 type macvlan
ssh beta sudo ip netns del entr02

ssh gamma sudo ip route del 169.254.215.29 dev eth1 src 169.254.94.223

echo "beta vede gamma e viceversa"
ssh beta "ping -q -n -c 1 10.0.0.22 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.22"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.86 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.86"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.62"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.50 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.50"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.40 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.40"; exit 1)

### Ingresso di 𝜇 in G𝛿
echo "Ingresso mu in G-delta (analogo)"

ssh mu sudo ip route add 169.254.253.216 dev eth1 src 169.254.119.176

ssh delta sudo ip route add 169.254.119.176 dev eth1 src 169.254.253.216

ssh mu sudo ip netns add entr01
ssh mu sudo ip netns exec entr01 sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh mu sudo ip netns exec entr01 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh mu sudo ip link add dev entr01_eth1 link eth1 type macvlan
ssh mu sudo ip link set dev entr01_eth1 netns entr01
ssh mu sudo ip netns exec entr01 ip link set dev entr01_eth1 address 00:16:3E:71:33:12
ssh mu sudo ip netns exec entr01 sysctl net.ipv4.conf.entr01_eth1.rp_filter=0 &>/dev/null
ssh mu sudo ip netns exec entr01 sysctl net.ipv4.conf.entr01_eth1.arp_ignore=1 &>/dev/null
ssh mu sudo ip netns exec entr01 sysctl net.ipv4.conf.entr01_eth1.arp_announce=2 &>/dev/null
ssh mu sudo ip netns exec entr01 ip link set dev entr01_eth1 up
ssh mu sudo ip netns exec entr01 ip address add 169.254.101.161 dev entr01_eth1
ssh mu sudo ip netns exec entr01 ip route add 169.254.253.216 dev entr01_eth1 src 169.254.101.161

ssh delta sudo ip route add 169.254.101.161 dev eth1 src 169.254.253.216

ssh mu sudo ip netns exec entr01 ip rule add table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.24/29 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.88/29 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.12/30 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.76/30 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.60/30 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.8/31 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.72/31 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.56/31 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.48/31 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.10/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.74/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.58/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.50/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.40/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.11/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.75/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.59/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.51/32 table ntk
ssh mu sudo ip netns exec entr01 ip route add unreachable 10.0.0.41/32 table ntk
ssh mu sudo ip route del 10.0.0.0/29 table ntk
ssh mu sudo ip route del 10.0.0.64/29 table ntk
ssh mu sudo ip route del 10.0.0.16/29 table ntk
ssh mu sudo ip route del 10.0.0.80/29 table ntk
ssh mu sudo ip route del 10.0.0.24/29 table ntk
ssh mu sudo ip route del 10.0.0.88/29 table ntk
ssh mu sudo ip route del 10.0.0.12/30 table ntk
ssh mu sudo ip route del 10.0.0.76/30 table ntk
ssh mu sudo ip route del 10.0.0.60/30 table ntk
ssh mu sudo ip route del 10.0.0.8/31 table ntk
ssh mu sudo ip route del 10.0.0.72/31 table ntk
ssh mu sudo ip route del 10.0.0.56/31 table ntk
ssh mu sudo ip route del 10.0.0.48/31 table ntk
ssh mu sudo ip route del 10.0.0.10/32 table ntk
ssh mu sudo ip route del 10.0.0.74/32 table ntk
ssh mu sudo ip route del 10.0.0.58/32 table ntk
ssh mu sudo ip route del 10.0.0.50/32 table ntk
ssh mu sudo ip route del 10.0.0.40/32 table ntk

ssh mu sudo iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.11
ssh mu sudo ip address del 10.0.0.11/32 dev eth1
ssh mu sudo ip address del 10.0.0.75/32 dev eth1
ssh mu sudo ip address del 10.0.0.59/32 dev eth1
ssh mu sudo ip address del 10.0.0.51/32 dev eth1
ssh mu sudo ip address del 10.0.0.41/32 dev eth1

ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.24/29 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.88/29 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.12/30 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.76/30 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.60/30 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.8/31 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.72/31 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.56/31 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.48/31 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.10/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.74/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.58/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.50/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.40/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.11/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.75/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.59/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.51/32 table ntk
ssh mu sudo ip netns exec entr01 ip route change unreachable 10.0.0.41/32 table ntk

ssh mu sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.8/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.72/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.24/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.88/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.56/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.30/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.94/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.62/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.50/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.28/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.92/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.60/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.48/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.40/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.29/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.93/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.61/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.49/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.41/32 table ntk

(echo; echo "250 ntk_from_00:16:3E:1A:C4:45 # xxx_table_ntk_from_00:16:3E:1A:C4:45_xxx") | ssh mu sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh mu sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.16/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.80/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.24/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.88/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.30/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.94/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.28/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.92/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.60/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.48/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.29/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.93/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.24/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.88/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.30/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.94/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.62/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.50/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.28/32 table ntk
ssh mu sudo ip route change unreachable 10.0.0.92/32 table ntk
ssh mu sudo ip route change unreachable 10.0.0.60/32 table ntk
ssh mu sudo ip route change unreachable 10.0.0.48/32 table ntk
ssh mu sudo ip route change unreachable 10.0.0.40/32 table ntk
ssh mu sudo ip route change 10.0.0.29/32 table ntk via 169.254.253.216 dev eth1
ssh mu sudo ip route change 10.0.0.93/32 table ntk via 169.254.253.216 dev eth1
ssh mu sudo ip route change 10.0.0.61/32 table ntk via 169.254.253.216 dev eth1
ssh mu sudo ip route change 10.0.0.49/32 table ntk via 169.254.253.216 dev eth1
ssh mu sudo ip route change 10.0.0.41/32 table ntk via 169.254.253.216 dev eth1
ssh mu sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.28/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.92/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.29/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.93/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:1A:C4:45 -j MARK --set-mark 250
ssh mu sudo ip rule add fwmark 250 table ntk_from_00:16:3E:1A:C4:45

(echo; echo "250 ntk_from_00:16:3E:2D:8D:DE # xxx_table_ntk_from_00:16:3E:2D:8D:DE_xxx") | ssh delta sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh delta sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.16/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.80/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.24/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.88/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.30/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.94/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.28/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.92/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.28/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.92/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.16/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.80/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.24/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.88/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.30/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.94/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.62/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.50/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.28/32 table ntk
ssh delta sudo ip route change unreachable 10.0.0.92/32 table ntk
ssh delta sudo ip route change unreachable 10.0.0.60/32 table ntk
ssh delta sudo ip route change unreachable 10.0.0.48/32 table ntk
ssh delta sudo ip route change unreachable 10.0.0.40/32 table ntk
ssh delta sudo iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:2D:8D:DE -j MARK --set-mark 250
ssh delta sudo ip rule add fwmark 250 table ntk_from_00:16:3E:2D:8D:DE

ssh mu sudo ip address add 10.0.0.28 dev eth1
ssh mu sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.28
ssh mu sudo ip address add 10.0.0.92 dev eth1
ssh mu sudo ip address add 10.0.0.60 dev eth1
ssh mu sudo ip address add 10.0.0.48 dev eth1
ssh mu sudo ip address add 10.0.0.40 dev eth1
ssh mu sudo ip route del 10.0.0.28/32 table ntk
ssh mu sudo ip route del 10.0.0.92/32 table ntk
ssh mu sudo ip route del 10.0.0.60/32 table ntk
ssh mu sudo ip route del 10.0.0.48/32 table ntk
ssh mu sudo ip route del 10.0.0.40/32 table ntk
ssh mu sudo ip route del 10.0.0.28/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.92/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.60/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.48/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.40/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.24/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.88/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.30/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.94/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.62/31 table ntk
ssh mu sudo ip route change unreachable 10.0.0.50/31 table ntk
ssh mu sudo ip route change 10.0.0.29/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.28
ssh mu sudo ip route change 10.0.0.93/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.28
ssh mu sudo ip route change 10.0.0.61/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
ssh mu sudo ip route change 10.0.0.49/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.48
ssh mu sudo ip route change 10.0.0.41/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.40
ssh mu sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.29/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.93/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45

ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.28/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.92/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.16/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.80/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.24/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.88/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.30/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.94/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.62/31 table ntk
ssh delta sudo ip route change unreachable 10.0.0.50/31 table ntk
ssh delta sudo ip route change 10.0.0.28/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.29
ssh delta sudo ip route change 10.0.0.92/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.29
ssh delta sudo ip route change 10.0.0.60/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.61
ssh delta sudo ip route change 10.0.0.48/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.49
ssh delta sudo ip route change 10.0.0.40/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.41

ssh mu sudo ip netns exec entr01 ip route flush table main
ssh mu sudo ip netns exec entr01 ip link delete entr01_eth1 type macvlan
ssh mu sudo ip netns del entr01

ssh delta sudo ip route del 169.254.101.161 dev eth1 src 169.254.253.216

echo "mu vede delta e viceversa"
ssh mu "ping -q -n -c 1 10.0.0.29 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.29"; exit 1)
ssh mu "ping -q -n -c 1 10.0.0.93 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.93"; exit 1)
ssh mu "ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.61"; exit 1)
ssh mu "ping -q -n -c 1 10.0.0.49 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.49"; exit 1)
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Ingresso del g-nodo 𝜇+𝛿 in G𝛾"

# Durante queste operazioni, il sistema *𝛿* deve mantenersi sempre in grado di comunicare con *𝜇*.
# tramite l'indirizzo IP interno al g-nodo di livello 1. Per questo ogni tanto mettiamo un comando di ping.

echo "arco tra *𝛿* e *𝛾*:"

ssh delta sudo ip route add 169.254.94.223 dev eth1 src 169.254.253.216
ssh gamma sudo ip route add 169.254.253.216 dev eth1 src 169.254.94.223
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Nei sistemi *𝜇* e *𝛿* le vecchie identità si spostano in un namespace"

ssh delta sudo ip netns add entr03
ssh delta sudo ip netns exec entr03 sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh delta sudo ip netns exec entr03 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh delta sudo ip link add dev entr03_eth1 link eth1 type macvlan
ssh delta sudo ip link set dev entr03_eth1 netns entr03
ssh delta sudo ip netns exec entr03 ip link set dev entr03_eth1 address 00:16:3E:B9:77:80
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.rp_filter=0 &>/dev/null
ssh delta sudo ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.arp_ignore=1 &>/dev/null
ssh delta sudo ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.arp_announce=2 &>/dev/null
ssh delta sudo ip netns exec entr03 ip link set dev entr03_eth1 up
ssh delta sudo ip netns exec entr03 ip address add 169.254.83.167 dev entr03_eth1
ssh delta sudo ip netns exec entr03 ip route add 169.254.242.91 dev entr03_eth1 src 169.254.83.167
ssh delta sudo ip netns exec entr03 ip route add 169.254.94.223 dev entr03_eth1 src 169.254.83.167
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

ssh mu sudo ip netns add entr03
ssh mu sudo ip netns exec entr03 sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh mu sudo ip netns exec entr03 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh mu sudo ip link add dev entr03_eth1 link eth1 type macvlan
ssh mu sudo ip link set dev entr03_eth1 netns entr03
ssh mu sudo ip netns exec entr03 ip link set dev entr03_eth1 address 00:16:3E:DF:23:F5
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.rp_filter=0 &>/dev/null
ssh mu sudo ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.arp_ignore=1 &>/dev/null
ssh mu sudo ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.arp_announce=2 &>/dev/null
ssh mu sudo ip netns exec entr03 ip link set dev entr03_eth1 up
ssh mu sudo ip netns exec entr03 ip address add 169.254.242.91 dev entr03_eth1
ssh mu sudo ip netns exec entr03 ip route add 169.254.83.167 dev entr03_eth1 src 169.254.242.91
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

ssh gamma sudo ip route add 169.254.83.167 dev eth1 src 169.254.94.223

ssh delta sudo ip netns exec entr03 ip rule add table ntk
(echo; echo "249 ntk_from_00:16:3E:DF:23:F5 # xxx_table_ntk_from_00:16:3E:DF:23:F5_xxx") | ssh delta sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh delta sudo ip netns exec entr03 iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:DF:23:F5 -j MARK --set-mark 249
ssh delta sudo ip netns exec entr03 ip rule add fwmark 249 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.40/32 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:DF:23:F5
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip route del 10.0.0.28/32 table ntk
ssh delta sudo ip route del 10.0.0.92/32 table ntk
ssh delta sudo ip route del 10.0.0.60/32 table ntk
ssh delta sudo ip route del 10.0.0.48/32 table ntk
ssh delta sudo ip route del 10.0.0.28/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.92/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.16/29 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.80/29 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.24/30 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.88/30 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.56/30 table ntk
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.30/31 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.94/31 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.62/31 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.50/31 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.28/31 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.92/31 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.60/31 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.48/31 table ntk
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.16/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.80/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.24/30 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.88/30 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.30/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.94/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.28/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.92/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:DF:23:F5
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip route del 10.0.0.0/29 table ntk
ssh delta sudo ip route del 10.0.0.64/29 table ntk
ssh delta sudo ip route del 10.0.0.8/29 table ntk
ssh delta sudo ip route del 10.0.0.72/29 table ntk
ssh delta sudo ip route del 10.0.0.16/29 table ntk
ssh delta sudo ip route del 10.0.0.80/29 table ntk
ssh delta sudo ip route del 10.0.0.24/30 table ntk
ssh delta sudo ip route del 10.0.0.88/30 table ntk
ssh delta sudo ip route del 10.0.0.56/30 table ntk
ssh delta sudo ip route del 10.0.0.30/31 table ntk
ssh delta sudo ip route del 10.0.0.94/31 table ntk
ssh delta sudo ip route del 10.0.0.62/31 table ntk
ssh delta sudo ip route del 10.0.0.50/31 table ntk
ssh delta sudo ip route del 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.16/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.80/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.24/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.88/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.30/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.94/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.29
ssh delta sudo ip address del 10.0.0.29/32 dev eth1
ssh delta sudo ip address del 10.0.0.93/32 dev eth1
ssh delta sudo ip address del 10.0.0.61/32 dev eth1
ssh delta sudo ip address del 10.0.0.49/32 dev eth1
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.16/29 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.80/29 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.24/30 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.88/30 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.56/30 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.30/31 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.94/31 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.62/31 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.50/31 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.28/31 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.92/31 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.60/31 table ntk
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.48/31 table ntk
ssh delta sudo ip netns exec entr03 ip route change 10.0.0.40/32 table ntk via 169.254.242.91 dev entr03_eth1
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.28/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.92/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:DF:23:F5
ssh delta sudo ip netns exec entr03 ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:DF:23:F5
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

ssh mu sudo ip netns exec entr03 ip rule add table ntk
(echo; echo "249 ntk_from_00:16:3E:B9:77:80 # xxx_table_ntk_from_00:16:3E:B9:77:80_xxx") | ssh mu sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh mu sudo ip netns exec entr03 iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:B9:77:80 -j MARK --set-mark 249
ssh mu sudo ip netns exec entr03 ip rule add fwmark 249 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.41/32 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip route del 10.0.0.29/32 table ntk
ssh mu sudo ip route del 10.0.0.93/32 table ntk
ssh mu sudo ip route del 10.0.0.61/32 table ntk
ssh mu sudo ip route del 10.0.0.49/32 table ntk
ssh mu sudo ip route del 10.0.0.29/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.93/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.8/29 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.72/29 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.24/30 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.88/30 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.56/30 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.30/31 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.94/31 table ntk
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.62/31 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.50/31 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.28/31 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.92/31 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.60/31 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.48/31 table ntk
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.16/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.80/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.24/30 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.88/30 table ntk_from_00:16:3E:B9:77:80
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.30/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.94/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.28/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.92/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip route del 10.0.0.0/29 table ntk
ssh mu sudo ip route del 10.0.0.64/29 table ntk
ssh mu sudo ip route del 10.0.0.8/29 table ntk
ssh mu sudo ip route del 10.0.0.72/29 table ntk
ssh mu sudo ip route del 10.0.0.16/29 table ntk
ssh mu sudo ip route del 10.0.0.80/29 table ntk
ssh mu sudo ip route del 10.0.0.24/30 table ntk
ssh mu sudo ip route del 10.0.0.88/30 table ntk
ssh mu sudo ip route del 10.0.0.56/30 table ntk
ssh mu sudo ip route del 10.0.0.30/31 table ntk
ssh mu sudo ip route del 10.0.0.94/31 table ntk
ssh mu sudo ip route del 10.0.0.62/31 table ntk
ssh mu sudo ip route del 10.0.0.50/31 table ntk
ssh mu sudo ip route del 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.16/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.80/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.24/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.88/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.30/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.94/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.28
ssh mu sudo ip address del 10.0.0.28/32 dev eth1
ssh mu sudo ip address del 10.0.0.92/32 dev eth1
ssh mu sudo ip address del 10.0.0.60/32 dev eth1
ssh mu sudo ip address del 10.0.0.48/32 dev eth1
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.8/29 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.72/29 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.16/29 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.80/29 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.24/30 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.88/30 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.56/30 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.30/31 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.94/31 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.62/31 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.50/31 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.28/31 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.92/31 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.60/31 table ntk
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.48/31 table ntk
ssh mu sudo ip netns exec entr03 ip route change 10.0.0.41/32 table ntk via 169.254.83.167 dev entr03_eth1
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:B9:77:80
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.28/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.92/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:B9:77:80
ssh mu sudo ip netns exec entr03 ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:B9:77:80
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Nei sistemi *𝛿* e *𝜇* si instanziano nuovi QspnManager"

ssh delta sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.24/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.88/29 table ntk
ssh delta sudo ip route add unreachable 10.0.0.16/30 table ntk
ssh delta sudo ip route add unreachable 10.0.0.80/30 table ntk
ssh delta sudo ip route add unreachable 10.0.0.56/30 table ntk
ssh delta sudo ip route add unreachable 10.0.0.20/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.84/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.60/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.48/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.22/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.86/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.62/31 table ntk
ssh delta sudo ip route add unreachable 10.0.0.50/31 table ntk
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.22/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.86/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip address add 10.0.0.21 dev eth1
ssh delta sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.21
ssh delta sudo ip address add 10.0.0.85 dev eth1
ssh delta sudo ip address add 10.0.0.61 dev eth1
ssh delta sudo ip address add 10.0.0.49 dev eth1
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip route del 10.0.0.20/31 table ntk
ssh delta sudo ip route del 10.0.0.84/31 table ntk
ssh delta sudo ip route del 10.0.0.60/31 table ntk
ssh delta sudo ip route del 10.0.0.48/31 table ntk
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip route add unreachable 10.0.0.20/32 table ntk
ssh delta sudo ip route add unreachable 10.0.0.84/32 table ntk
ssh delta sudo ip route add unreachable 10.0.0.60/32 table ntk
ssh delta sudo ip route add unreachable 10.0.0.48/32 table ntk
ssh delta sudo ip route del 10.0.0.20/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.84/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.60/31 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route del 10.0.0.48/31 table ntk_from_00:16:3E:2D:8D:DE
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip route add unreachable 10.0.0.20/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.84/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route add unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

ssh mu sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.8/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.72/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.24/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.88/29 table ntk
ssh mu sudo ip route add unreachable 10.0.0.16/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.80/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.56/30 table ntk
ssh mu sudo ip route add unreachable 10.0.0.20/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.84/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.60/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.48/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.22/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.86/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.62/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.50/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.22/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.86/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip address add 10.0.0.20 dev eth1
ssh mu sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.20
ssh mu sudo ip address add 10.0.0.84 dev eth1
ssh mu sudo ip address add 10.0.0.60 dev eth1
ssh mu sudo ip address add 10.0.0.48 dev eth1
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo ip route del 10.0.0.20/31 table ntk
ssh mu sudo ip route del 10.0.0.84/31 table ntk
ssh mu sudo ip route del 10.0.0.60/31 table ntk
ssh mu sudo ip route del 10.0.0.48/31 table ntk
ssh mu sudo ip route add unreachable 10.0.0.21/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.85/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.61/32 table ntk
ssh mu sudo ip route add unreachable 10.0.0.49/32 table ntk
ssh mu sudo ip route del 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route del 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.21/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.85/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route add unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Il QspnManager del sistema *𝛾* riceve un nuovo arco, ma per ora nessun ETP da esso."

(echo; echo "249 ntk_from_00:16:3E:1A:C4:45 # xxx_table_ntk_from_00:16:3E:1A:C4:45_xxx") | ssh gamma sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh gamma sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45

echo "Il QspnManager del sistema *𝛿* riceve un ETP da *𝛾*."

(echo; echo "248 ntk_from_00:16:3E:5B:78:D5 # xxx_table_ntk_from_00:16:3E:5B:78:D5_xxx") | ssh delta sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh delta sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.22/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.86/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.20/32 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.84/32 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.60/32 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.48/32 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh delta sudo ip route change 10.0.0.22/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.86/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.62/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.61
ssh delta sudo ip route change 10.0.0.50/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.49
ssh delta sudo ip route change 10.0.0.20/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.84/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.60/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.61
ssh delta sudo ip route change 10.0.0.48/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.49
ssh delta sudo ip route change 10.0.0.40/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.41
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.22/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.86/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change 10.0.0.20/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.84/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.60/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1 src 10.0.0.61
ssh delta sudo ip route change 10.0.0.48/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1 src 10.0.0.49
ssh delta sudo ip route change blackhole 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change 10.0.0.22/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.86/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1 src 10.0.0.61
ssh delta sudo ip route change 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1 src 10.0.0.49
ssh delta sudo ip route change unreachable 10.0.0.20/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.84/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:5B:78:D5 -j MARK --set-mark 248
ssh delta sudo ip rule add fwmark 248 table ntk_from_00:16:3E:5B:78:D5
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Il sistema *𝛿* propaga l'ETP a *𝜇*."

ssh mu sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh mu sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh mu sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh mu sudo ip route change 10.0.0.22/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
ssh mu sudo ip route change 10.0.0.86/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
ssh mu sudo ip route change 10.0.0.62/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
ssh mu sudo ip route change 10.0.0.50/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.48
ssh mu sudo ip route change 10.0.0.21/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
ssh mu sudo ip route change 10.0.0.85/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
ssh mu sudo ip route change 10.0.0.61/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
ssh mu sudo ip route change 10.0.0.49/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.48
ssh mu sudo ip route change 10.0.0.41/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.40
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)
ssh mu sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.22/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.86/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.21/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.85/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Il sistema *𝛿* invia un ETP a *𝛾*"

ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change blackhole 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh gamma sudo ip route change 10.0.0.23/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.87/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.63/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.51/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change 10.0.0.41/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.40
ssh gamma sudo iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:1A:C4:45 -j MARK --set-mark 249
ssh gamma sudo ip rule add fwmark 249 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change blackhole 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh gamma sudo ip route change 10.0.0.20/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.84/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.60/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.48/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change 10.0.0.23/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.87/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.63/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.51/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change 10.0.0.41/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.40

echo "Il sistema *𝛽* vede arrivare un ETP da *𝛾* con il quale scopre un percorso verso la destinazione 2·1·0·."

ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh beta sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh beta sudo ip route change 10.0.0.20/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.84/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.60/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
ssh beta sudo ip route change 10.0.0.48/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
ssh beta sudo ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
ssh beta sudo ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
ssh beta sudo ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.41
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5

echo "identità di connettività possono essere dismesse."

ssh mu sudo ip netns exec entr03 ip route flush table main
ssh mu sudo ip netns exec entr03 ip link delete entr03_eth1 type macvlan
ssh mu sudo ip netns del entr03
ssh mu sudo sed -i '/xxx_table_ntk_from_00:16:3E:B9:77:80_xxx/d' /etc/iproute2/rt_tables

ssh delta sudo ip netns exec entr03 ip route flush table main
ssh delta sudo ip netns exec entr03 ip link delete entr03_eth1 type macvlan
ssh delta sudo ip netns del entr03
ssh delta sudo sed -i '/xxx_table_ntk_from_00:16:3E:DF:23:F5_xxx/d' /etc/iproute2/rt_tables

ssh gamma sudo ip route del 169.254.83.167 dev eth1 src 169.254.94.223
ssh mu "ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null" || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "beta vede gamma delta e mu"
ssh beta "ping -q -n -c 1 10.0.0.22 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.22"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.86 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.86"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.62"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.50 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.50"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.40 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.40"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.21 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.21"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.85 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.85"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.61"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.49 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.49"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.20"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.84"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.60"; exit 1)
ssh beta "ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null" || (echo "beta: errore ping 10.0.0.48"; exit 1)
echo "gamma vede delta e mu"
ssh gamma "ping -q -n -c 1 10.0.0.21 -W 1 &>/dev/null" || (echo "gamma: errore ping 10.0.0.21"; exit 1)
ssh gamma "ping -q -n -c 1 10.0.0.85 -W 1 &>/dev/null" || (echo "gamma: errore ping 10.0.0.85"; exit 1)
ssh gamma "ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null" || (echo "gamma: errore ping 10.0.0.61"; exit 1)
ssh gamma "ping -q -n -c 1 10.0.0.49 -W 1 &>/dev/null" || (echo "gamma: errore ping 10.0.0.49"; exit 1)
ssh gamma "ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null" || (echo "gamma: errore ping 10.0.0.20"; exit 1)
ssh gamma "ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null" || (echo "gamma: errore ping 10.0.0.84"; exit 1)
ssh gamma "ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null" || (echo "gamma: errore ping 10.0.0.60"; exit 1)
ssh gamma "ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null" || (echo "gamma: errore ping 10.0.0.48"; exit 1)
echo "delta vede mu"
ssh delta "ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null" || (echo "delta: errore ping 10.0.0.20"; exit 1)
ssh delta "ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null" || (echo "delta: errore ping 10.0.0.84"; exit 1)
ssh delta "ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null" || (echo "delta: errore ping 10.0.0.60"; exit 1)
ssh delta "ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null" || (echo "delta: errore ping 10.0.0.48"; exit 1)
ssh delta "ping -q -n -c 1 10.0.0.40 -W 1 &>/dev/null" || (echo "delta: errore ping 10.0.0.40"; exit 1)

### Ingresso di 𝛼 in G𝛾
echo "Ingresso alfa in G-gamma"

ssh alfa sudo ip route add 169.254.96.141 dev eth1 src 169.254.69.30

ssh beta sudo ip route add 169.254.69.30 dev eth1 src 169.254.96.141

ssh alfa sudo ip netns add entr04
ssh alfa sudo ip netns exec entr04 sysctl net.ipv4.ip_forward=1 &>/dev/null
ssh alfa sudo ip netns exec entr04 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
ssh alfa sudo ip link add dev entr04_eth1 link eth1 type macvlan
ssh alfa sudo ip link set dev entr04_eth1 netns entr04
ssh alfa sudo ip netns exec entr04 ip link set dev entr04_eth1 address 00:16:3E:78:18:0B
ssh alfa sudo ip netns exec entr04 sysctl net.ipv4.conf.entr04_eth1.rp_filter=0 &>/dev/null
ssh alfa sudo ip netns exec entr04 sysctl net.ipv4.conf.entr04_eth1.arp_ignore=1 &>/dev/null
ssh alfa sudo ip netns exec entr04 sysctl net.ipv4.conf.entr04_eth1.arp_announce=2 &>/dev/null
ssh alfa sudo ip netns exec entr04 ip link set dev entr04_eth1 up
ssh alfa sudo ip netns exec entr04 ip address add 169.254.202.128 dev entr04_eth1
ssh alfa sudo ip netns exec entr04 ip route add 169.254.96.141 dev entr04_eth1 src 169.254.202.128

ssh beta sudo ip route add 169.254.202.128 dev eth1 src 169.254.96.141

echo "alfa0 in networkspace entr04"
ssh alfa sudo ip netns exec entr04 ip rule add table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.0/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.64/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.8/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.72/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.16/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.80/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.28/30 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.92/30 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.60/30 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.24/31 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.88/31 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.56/31 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.48/31 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.27/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.91/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.59/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.51/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.41/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.26/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.90/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.58/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.50/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route add unreachable 10.0.0.40/32 table ntk
ssh alfa sudo ip route del 10.0.0.0/29 table ntk
ssh alfa sudo ip route del 10.0.0.64/29 table ntk
ssh alfa sudo ip route del 10.0.0.8/29 table ntk
ssh alfa sudo ip route del 10.0.0.72/29 table ntk
ssh alfa sudo ip route del 10.0.0.16/29 table ntk
ssh alfa sudo ip route del 10.0.0.80/29 table ntk
ssh alfa sudo ip route del 10.0.0.28/30 table ntk
ssh alfa sudo ip route del 10.0.0.92/30 table ntk
ssh alfa sudo ip route del 10.0.0.60/30 table ntk
ssh alfa sudo ip route del 10.0.0.24/31 table ntk
ssh alfa sudo ip route del 10.0.0.88/31 table ntk
ssh alfa sudo ip route del 10.0.0.56/31 table ntk
ssh alfa sudo ip route del 10.0.0.48/31 table ntk
ssh alfa sudo ip route del 10.0.0.27/32 table ntk
ssh alfa sudo ip route del 10.0.0.91/32 table ntk
ssh alfa sudo ip route del 10.0.0.59/32 table ntk
ssh alfa sudo ip route del 10.0.0.51/32 table ntk
ssh alfa sudo ip route del 10.0.0.41/32 table ntk
ssh alfa sudo iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.26
ssh alfa sudo ip address del 10.0.0.26/32 dev eth1
ssh alfa sudo ip address del 10.0.0.90/32 dev eth1
ssh alfa sudo ip address del 10.0.0.58/32 dev eth1
ssh alfa sudo ip address del 10.0.0.50/32 dev eth1
ssh alfa sudo ip address del 10.0.0.40/32 dev eth1
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.0/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.64/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.8/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.72/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.16/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.80/29 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.28/30 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.92/30 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.60/30 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.24/31 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.88/31 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.56/31 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.48/31 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.27/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.91/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.59/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.51/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.41/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.26/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.90/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.58/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.50/32 table ntk
ssh alfa sudo ip netns exec entr04 ip route change unreachable 10.0.0.40/32 table ntk

echo "alfa1 in G-gamma"
# alfa start
ssh alfa sudo ip address add 10.0.0.50 dev eth1
ssh alfa sudo ip address add 10.0.0.40 dev eth1
ssh alfa sudo ip route add unreachable 10.0.0.0/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.64/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.8/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.72/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.24/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.88/29 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.16/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.80/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.56/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.20/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.84/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.60/30 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.48/31 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.51/32 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.41/32 table ntk
# alfa new arc
(echo; echo "250 ntk_from_00:16:3E:EC:A3:E1 # xxx_table_ntk_from_00:16:3E:EC:A3:E1_xxx") | ssh alfa sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh alfa sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.20/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.84/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.60/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
# beta new arc
(echo; echo "249 ntk_from_00:16:3E:FD:E2:AA # xxx_table_ntk_from_00:16:3E:FD:E2:AA_xxx") | ssh beta sudo tee -a /etc/iproute2/rt_tables >/dev/null
ssh beta sudo ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.22/32 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.86/32 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.62/32 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.50/32 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:FD:E2:AA
# alfa gets ETP from beta
ssh alfa sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.16/30 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.80/30 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.56/30 table ntk
ssh alfa sudo ip route change 10.0.0.20/30 table ntk via 169.254.96.141 dev eth1
ssh alfa sudo ip route change 10.0.0.84/30 table ntk via 169.254.96.141 dev eth1
ssh alfa sudo ip route change 10.0.0.60/30 table ntk via 169.254.96.141 dev eth1
ssh alfa sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.51/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.41/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.20/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.84/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.60/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:EC:A3:E1 -j MARK --set-mark 250
ssh alfa sudo ip rule add fwmark 250 table ntk_from_00:16:3E:EC:A3:E1
# alfa gets real address
ssh alfa sudo ip address add 10.0.0.18 dev eth1
ssh alfa sudo iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.18
ssh alfa sudo ip address add 10.0.0.82 dev eth1
ssh alfa sudo ip address add 10.0.0.58 dev eth1
ssh alfa sudo ip route del 10.0.0.16/30 table ntk
ssh alfa sudo ip route del 10.0.0.80/30 table ntk
ssh alfa sudo ip route del 10.0.0.56/30 table ntk
ssh alfa sudo ip route del 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route del 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route del 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.16/31 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.80/31 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.56/31 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.19/32 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.83/32 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.59/32 table ntk
ssh alfa sudo ip route add unreachable 10.0.0.16/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.80/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.56/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.19/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.83/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route add unreachable 10.0.0.59/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh alfa sudo ip route change 10.0.0.20/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.18
ssh alfa sudo ip route change 10.0.0.84/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.18
ssh alfa sudo ip route change 10.0.0.60/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.58
ssh alfa sudo ip route change unreachable 10.0.0.16/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.80/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.56/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.48/31 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.19/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.83/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.59/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.51/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.41/32 table ntk
ssh alfa sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.20/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.84/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.60/30 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.16/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.80/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.56/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.19/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.83/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.59/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh alfa sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
# beta gets ETP from alfa
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh beta sudo ip route change 10.0.0.16/30 table ntk via 169.254.69.30 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.80/30 table ntk via 169.254.69.30 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.56/30 table ntk via 169.254.69.30 dev eth1 src 10.0.0.63
ssh beta sudo ip route change 10.0.0.20/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.84/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.60/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
ssh beta sudo ip route change 10.0.0.48/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
ssh beta sudo ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
ssh beta sudo ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
ssh beta sudo ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
ssh beta sudo ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.41
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev eth1
ssh beta sudo ip route change 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev eth1
ssh beta sudo ip route change 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev eth1
ssh beta sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
ssh beta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change 10.0.0.20/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
ssh beta sudo ip route change 10.0.0.84/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
ssh beta sudo ip route change 10.0.0.60/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
ssh beta sudo ip route change blackhole 10.0.0.48/31 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change 10.0.0.22/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
ssh beta sudo ip route change 10.0.0.86/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
ssh beta sudo ip route change 10.0.0.62/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
ssh beta sudo ip route change blackhole 10.0.0.50/32 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo ip route change blackhole 10.0.0.40/32 table ntk_from_00:16:3E:FD:E2:AA
ssh beta sudo iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:FD:E2:AA -j MARK --set-mark 249
ssh beta sudo ip rule add fwmark 249 table ntk_from_00:16:3E:FD:E2:AA
# gamma gets ETP from beta
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh gamma sudo ip route change 10.0.0.16/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.80/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.56/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.20/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.84/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.60/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.48/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change 10.0.0.23/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.87/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
ssh gamma sudo ip route change 10.0.0.63/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
ssh gamma sudo ip route change 10.0.0.51/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.50
ssh gamma sudo ip route change 10.0.0.41/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.40
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
ssh gamma sudo ip route change 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
ssh gamma sudo ip route change 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
ssh gamma sudo ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
ssh gamma sudo ip route change 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
ssh gamma sudo ip route change 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
ssh gamma sudo ip route change 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
ssh gamma sudo ip route change blackhole 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
ssh gamma sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1
ssh gamma sudo ip route change 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1
ssh gamma sudo ip route change 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1
ssh gamma sudo ip route change 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1
ssh gamma sudo ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
ssh gamma sudo ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
# delta gets ETP from gamma
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.24/29 table ntk
ssh delta sudo ip route change unreachable 10.0.0.88/29 table ntk
ssh delta sudo ip route change 10.0.0.16/30 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.80/30 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.56/30 table ntk via 169.254.94.223 dev eth1 src 10.0.0.61
ssh delta sudo ip route change 10.0.0.22/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.86/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.62/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.61
ssh delta sudo ip route change 10.0.0.50/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.49
ssh delta sudo ip route change 10.0.0.20/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.84/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.21
ssh delta sudo ip route change 10.0.0.60/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.61
ssh delta sudo ip route change 10.0.0.48/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.49
ssh delta sudo ip route change 10.0.0.40/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.41
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.22/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.86/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change 10.0.0.20/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
ssh delta sudo ip route change 10.0.0.84/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
ssh delta sudo ip route change 10.0.0.60/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
ssh delta sudo ip route change 10.0.0.48/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
ssh delta sudo ip route change blackhole 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
ssh delta sudo ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change 10.0.0.16/30 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
ssh delta sudo ip route change 10.0.0.80/30 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
ssh delta sudo ip route change 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
ssh delta sudo ip route change 10.0.0.22/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
ssh delta sudo ip route change 10.0.0.86/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
ssh delta sudo ip route change 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
ssh delta sudo ip route change 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
ssh delta sudo ip route change unreachable 10.0.0.20/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.84/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
ssh delta sudo ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
# mu gets ETP from delta

echo "alfa0 dismessa"
ssh alfa sudo ip netns exec entr04 ip route flush table main
ssh alfa sudo ip netns exec entr04 ip link delete entr04_eth1 type macvlan
ssh alfa sudo ip netns del entr04

ssh beta sudo ip route del 169.254.202.128 dev eth1 src 169.254.96.141



echo "test completato"

