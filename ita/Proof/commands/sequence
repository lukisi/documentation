#!/bin/bash
set -e

## Sequenza temporale

### Prime operazioni
echo "Prime operazioni"

echo alfa
lxc exec alfa -- sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec alfa -- sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec alfa -- ip address add 10.0.0.32 dev lo
lxc exec alfa -- ip link set dev eth1 address 00:16:3E:FD:E2:AA
lxc exec alfa -- sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
lxc exec alfa -- sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
lxc exec alfa -- sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
lxc exec alfa -- ip link set dev eth1 up
lxc exec alfa -- ip address add 169.254.69.30 dev eth1
lxc exec alfa -- ip address add 10.0.0.26 dev eth1
lxc exec alfa -- ip address add 10.0.0.90 dev eth1
lxc exec alfa -- ip address add 10.0.0.58 dev eth1
lxc exec alfa -- ip address add 10.0.0.50 dev eth1
lxc exec alfa -- ip address add 10.0.0.40 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | lxc exec alfa -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec alfa -- ip rule add table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.16/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.80/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.28/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.92/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.60/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.24/31 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.88/31 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.56/31 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.27/32 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.91/32 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.59/32 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.51/32 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.41/32 table ntk
lxc exec alfa -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.26
lxc exec alfa -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.28/30 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.92/30 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.60/30 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.24/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.88/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.56/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.27/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.91/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.59/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.51/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.41/32 table ntk

echo beta
lxc exec beta -- sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec beta -- sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec beta -- ip address add 10.0.0.32 dev lo
lxc exec beta -- ip link set dev eth1 address 00:16:3E:EC:A3:E1
lxc exec beta -- sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
lxc exec beta -- sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
lxc exec beta -- sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
lxc exec beta -- ip link set dev eth1 up
lxc exec beta -- ip address add 169.254.96.141 dev eth1
lxc exec beta -- ip address add 10.0.0.10 dev eth1
lxc exec beta -- ip address add 10.0.0.74 dev eth1
lxc exec beta -- ip address add 10.0.0.58 dev eth1
lxc exec beta -- ip address add 10.0.0.50 dev eth1
lxc exec beta -- ip address add 10.0.0.40 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | lxc exec beta -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec beta -- ip rule add table ntk
lxc exec beta -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.16/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.80/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.12/30 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.76/30 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.60/30 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.8/31 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.72/31 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.56/31 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.11/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.75/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.59/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.51/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.41/32 table ntk
lxc exec beta -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.10
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.12/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.76/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.60/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.8/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.72/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.56/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.11/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.75/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.59/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.51/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.41/32 table ntk

echo gamma
lxc exec gamma -- sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec gamma -- sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec gamma -- ip address add 10.0.0.32 dev lo
lxc exec gamma -- ip link set dev eth1 address 00:16:3E:5B:78:D5
lxc exec gamma -- sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
lxc exec gamma -- sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
lxc exec gamma -- sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
lxc exec gamma -- ip link set dev eth1 up
lxc exec gamma -- ip address add 169.254.94.223 dev eth1
lxc exec gamma -- ip address add 10.0.0.22 dev eth1
lxc exec gamma -- ip address add 10.0.0.86 dev eth1
lxc exec gamma -- ip address add 10.0.0.62 dev eth1
lxc exec gamma -- ip address add 10.0.0.50 dev eth1
lxc exec gamma -- ip address add 10.0.0.40 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | lxc exec gamma -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec gamma -- ip rule add table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.24/29 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.88/29 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.16/30 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.80/30 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.20/31 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.84/31 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.60/31 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.23/32 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.87/32 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.63/32 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.51/32 table ntk
lxc exec gamma -- ip route add unreachable 10.0.0.41/32 table ntk
lxc exec gamma -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.22
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.23/32 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.87/32 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.63/32 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.51/32 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.41/32 table ntk

echo delta
lxc exec delta -- sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec delta -- sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec delta -- ip address add 10.0.0.32 dev lo
lxc exec delta -- ip link set dev eth1 address 00:16:3E:1A:C4:45
lxc exec delta -- sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
lxc exec delta -- sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
lxc exec delta -- sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
lxc exec delta -- ip link set dev eth1 up
lxc exec delta -- ip address add 169.254.253.216 dev eth1
lxc exec delta -- ip address add 10.0.0.29 dev eth1
lxc exec delta -- ip address add 10.0.0.93 dev eth1
lxc exec delta -- ip address add 10.0.0.61 dev eth1
lxc exec delta -- ip address add 10.0.0.49 dev eth1
lxc exec delta -- ip address add 10.0.0.41 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | lxc exec delta -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec delta -- ip rule add table ntk
lxc exec delta -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.16/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.80/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.24/30 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.88/30 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.30/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.94/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.62/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.50/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.28/32 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.92/32 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.60/32 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.48/32 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.40/32 table ntk
lxc exec delta -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.29
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.24/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.88/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.30/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.94/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.62/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.50/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.28/32 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.92/32 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.60/32 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.48/32 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.40/32 table ntk

echo mu
lxc exec mu -- sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec mu -- sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec mu -- ip address add 10.0.0.32 dev lo
lxc exec mu -- ip link set dev eth1 address 00:16:3E:2D:8D:DE
lxc exec mu -- sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
lxc exec mu -- sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
lxc exec mu -- sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
lxc exec mu -- ip link set dev eth1 up
lxc exec mu -- ip address add 169.254.119.176 dev eth1
lxc exec mu -- ip address add 10.0.0.11 dev eth1
lxc exec mu -- ip address add 10.0.0.75 dev eth1
lxc exec mu -- ip address add 10.0.0.59 dev eth1
lxc exec mu -- ip address add 10.0.0.51 dev eth1
lxc exec mu -- ip address add 10.0.0.41 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | lxc exec mu -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec mu -- ip rule add table ntk
lxc exec mu -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.24/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.88/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.12/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.76/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.60/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.8/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.72/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.56/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.10/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.74/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.58/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.50/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.40/32 table ntk
lxc exec mu -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.11
lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.12/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.76/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.60/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.8/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.72/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.56/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.10/32 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.74/32 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.58/32 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.50/32 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.40/32 table ntk

echo epsilon
lxc exec epsilon -- sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec epsilon -- sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec epsilon -- ip address add 10.0.0.32 dev lo
lxc exec epsilon -- ip link set dev eth1 address 00:16:3E:3C:14:33
lxc exec epsilon -- sysctl net.ipv4.conf.eth1.rp_filter=0 &>/dev/null
lxc exec epsilon -- sysctl net.ipv4.conf.eth1.arp_ignore=1 &>/dev/null
lxc exec epsilon -- sysctl net.ipv4.conf.eth1.arp_announce=2 &>/dev/null
lxc exec epsilon -- ip link set dev eth1 up
lxc exec epsilon -- ip address add 169.254.163.36 dev eth1
lxc exec epsilon -- ip address add 10.0.0.28 dev eth1
lxc exec epsilon -- ip address add 10.0.0.92 dev eth1
lxc exec epsilon -- ip address add 10.0.0.60 dev eth1
lxc exec epsilon -- ip address add 10.0.0.48 dev eth1
lxc exec epsilon -- ip address add 10.0.0.40 dev eth1
(echo; echo "251 ntk # xxx_table_ntk_xxx") | lxc exec epsilon -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec epsilon -- ip rule add table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.16/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.80/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.24/30 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.88/30 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.30/31 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.94/31 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.62/31 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.50/31 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.29/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.93/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.61/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.49/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.41/32 table ntk
lxc exec epsilon -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.28
lxc exec epsilon -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.24/30 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.88/30 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.30/31 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.94/31 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.62/31 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.50/31 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.29/32 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.93/32 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.61/32 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.49/32 table ntk
lxc exec epsilon -- ip route change unreachable 10.0.0.41/32 table ntk

### Ingresso di 𝛽 in G𝛾
echo "Ingresso beta in G-gamma"

lxc exec beta -- ip route add 169.254.94.223 dev eth1 src 169.254.96.141

lxc exec gamma -- ip route add 169.254.96.141 dev eth1 src 169.254.94.223

lxc exec beta -- ip netns add entr02
lxc exec beta -- ip netns exec entr02 sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec beta -- ip netns exec entr02 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec beta -- ip link add dev entr02_eth1 link eth1 type macvlan
lxc exec beta -- ip link set dev entr02_eth1 netns entr02
lxc exec beta -- ip netns exec entr02 ip link set dev entr02_eth1 address 00:16:3E:8E:91:B9
lxc exec beta -- ip netns exec entr02 sysctl net.ipv4.conf.entr02_eth1.rp_filter=0 &>/dev/null
lxc exec beta -- ip netns exec entr02 sysctl net.ipv4.conf.entr02_eth1.arp_ignore=1 &>/dev/null
lxc exec beta -- ip netns exec entr02 sysctl net.ipv4.conf.entr02_eth1.arp_announce=2 &>/dev/null
lxc exec beta -- ip netns exec entr02 ip link set dev entr02_eth1 up
lxc exec beta -- ip netns exec entr02 ip address add 169.254.215.29 dev entr02_eth1
lxc exec beta -- ip netns exec entr02 ip route add 169.254.94.223 dev entr02_eth1 src 169.254.215.29

lxc exec gamma -- ip route add 169.254.215.29 dev eth1 src 169.254.94.223

echo "beta0 in network namespace entr02"
lxc exec beta -- ip netns exec entr02 ip rule add table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.16/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.80/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.12/30 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.76/30 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.60/30 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.8/31 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.72/31 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.56/31 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.48/31 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.11/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.75/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.59/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.51/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.41/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.10/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.74/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.58/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.50/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route add unreachable 10.0.0.40/32 table ntk
lxc exec beta -- ip route del 10.0.0.0/29 table ntk
lxc exec beta -- ip route del 10.0.0.64/29 table ntk
lxc exec beta -- ip route del 10.0.0.16/29 table ntk
lxc exec beta -- ip route del 10.0.0.80/29 table ntk
lxc exec beta -- ip route del 10.0.0.24/29 table ntk
lxc exec beta -- ip route del 10.0.0.88/29 table ntk
lxc exec beta -- ip route del 10.0.0.12/30 table ntk
lxc exec beta -- ip route del 10.0.0.76/30 table ntk
lxc exec beta -- ip route del 10.0.0.60/30 table ntk
lxc exec beta -- ip route del 10.0.0.8/31 table ntk
lxc exec beta -- ip route del 10.0.0.72/31 table ntk
lxc exec beta -- ip route del 10.0.0.56/31 table ntk
lxc exec beta -- ip route del 10.0.0.48/31 table ntk
lxc exec beta -- ip route del 10.0.0.11/32 table ntk
lxc exec beta -- ip route del 10.0.0.75/32 table ntk
lxc exec beta -- ip route del 10.0.0.59/32 table ntk
lxc exec beta -- ip route del 10.0.0.51/32 table ntk
lxc exec beta -- ip route del 10.0.0.41/32 table ntk
lxc exec beta -- iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.10
lxc exec beta -- ip address del 10.0.0.10/32 dev eth1
lxc exec beta -- ip address del 10.0.0.74/32 dev eth1
lxc exec beta -- ip address del 10.0.0.58/32 dev eth1
lxc exec beta -- ip address del 10.0.0.50/32 dev eth1
lxc exec beta -- ip address del 10.0.0.40/32 dev eth1
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.16/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.80/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.12/30 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.76/30 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.60/30 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.8/31 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.72/31 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.56/31 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.48/31 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.11/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.75/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.59/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.51/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.41/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.10/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.74/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.58/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.50/32 table ntk
lxc exec beta -- ip netns exec entr02 ip route change unreachable 10.0.0.40/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.16/30 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.80/30 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.20/31 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.84/31 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.60/31 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.22/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.86/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.62/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.50/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.40/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.23/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.87/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.63/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.51/32 table ntk
lxc exec beta -- ip route add unreachable 10.0.0.41/32 table ntk

echo "beta1 in G-gamma"
(echo; echo "250 ntk_from_00:16:3E:5B:78:D5 # xxx_table_ntk_from_00:16:3E:5B:78:D5_xxx") | lxc exec beta -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec beta -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.20/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.84/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.60/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec beta -- ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev eth1
lxc exec beta -- ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev eth1
lxc exec beta -- ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev eth1
lxc exec beta -- ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev eth1
lxc exec beta -- ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev eth1
lxc exec beta -- ip route change unreachable 10.0.0.23/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.87/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.63/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.51/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.41/32 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:5B:78:D5 -j MARK --set-mark 250
lxc exec beta -- ip rule add fwmark 250 table ntk_from_00:16:3E:5B:78:D5

(echo; echo "250 ntk_from_00:16:3E:EC:A3:E1 # xxx_table_ntk_from_00:16:3E:EC:A3:E1_xxx") | lxc exec gamma -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec gamma -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.23/32 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.87/32 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.63/32 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.51/32 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.41/32 table ntk
lxc exec gamma -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:EC:A3:E1 -j MARK --set-mark 250
lxc exec gamma -- ip rule add fwmark 250 table ntk_from_00:16:3E:EC:A3:E1

lxc exec beta -- ip address add 10.0.0.23 dev eth1
lxc exec beta -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.23
lxc exec beta -- ip address add 10.0.0.87 dev eth1
lxc exec beta -- ip address add 10.0.0.63 dev eth1
lxc exec beta -- ip address add 10.0.0.51 dev eth1
lxc exec beta -- ip address add 10.0.0.41 dev eth1
lxc exec beta -- ip route del 10.0.0.23/32 table ntk
lxc exec beta -- ip route del 10.0.0.87/32 table ntk
lxc exec beta -- ip route del 10.0.0.63/32 table ntk
lxc exec beta -- ip route del 10.0.0.51/32 table ntk
lxc exec beta -- ip route del 10.0.0.41/32 table ntk
lxc exec beta -- ip route del 10.0.0.23/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.87/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.63/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.51/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.41/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.20/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.84/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.60/31 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec beta -- ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
lxc exec beta -- ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
lxc exec beta -- ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.41
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5

lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change 10.0.0.41/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.40

echo "beta0 dismessa"
lxc exec beta -- ip netns exec entr02 ip route flush table main
lxc exec beta -- ip netns exec entr02 ip link delete entr02_eth1 type macvlan
lxc exec beta -- ip netns del entr02

lxc exec gamma -- ip route del 169.254.215.29 dev eth1 src 169.254.94.223

echo "beta vede gamma e viceversa"
lxc exec beta -- ping -q -n -c 1 10.0.0.22 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.22"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.86 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.86"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.62"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.50 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.50"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.40 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.40"; exit 1)

### Ingresso di 𝜇 in G𝛿
echo "Ingresso mu in G-delta (analogo)"

lxc exec mu -- ip route add 169.254.253.216 dev eth1 src 169.254.119.176

lxc exec delta -- ip route add 169.254.119.176 dev eth1 src 169.254.253.216

lxc exec mu -- ip netns add entr01
lxc exec mu -- ip netns exec entr01 sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec mu -- ip netns exec entr01 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec mu -- ip link add dev entr01_eth1 link eth1 type macvlan
lxc exec mu -- ip link set dev entr01_eth1 netns entr01
lxc exec mu -- ip netns exec entr01 ip link set dev entr01_eth1 address 00:16:3E:71:33:12
lxc exec mu -- ip netns exec entr01 sysctl net.ipv4.conf.entr01_eth1.rp_filter=0 &>/dev/null
lxc exec mu -- ip netns exec entr01 sysctl net.ipv4.conf.entr01_eth1.arp_ignore=1 &>/dev/null
lxc exec mu -- ip netns exec entr01 sysctl net.ipv4.conf.entr01_eth1.arp_announce=2 &>/dev/null
lxc exec mu -- ip netns exec entr01 ip link set dev entr01_eth1 up
lxc exec mu -- ip netns exec entr01 ip address add 169.254.101.161 dev entr01_eth1
lxc exec mu -- ip netns exec entr01 ip route add 169.254.253.216 dev entr01_eth1 src 169.254.101.161

lxc exec delta -- ip route add 169.254.101.161 dev eth1 src 169.254.253.216

lxc exec mu -- ip netns exec entr01 ip rule add table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.24/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.88/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.12/30 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.76/30 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.60/30 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.8/31 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.72/31 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.56/31 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.48/31 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.10/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.74/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.58/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.50/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.40/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.11/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.75/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.59/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.51/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route add unreachable 10.0.0.41/32 table ntk
lxc exec mu -- ip route del 10.0.0.0/29 table ntk
lxc exec mu -- ip route del 10.0.0.64/29 table ntk
lxc exec mu -- ip route del 10.0.0.16/29 table ntk
lxc exec mu -- ip route del 10.0.0.80/29 table ntk
lxc exec mu -- ip route del 10.0.0.24/29 table ntk
lxc exec mu -- ip route del 10.0.0.88/29 table ntk
lxc exec mu -- ip route del 10.0.0.12/30 table ntk
lxc exec mu -- ip route del 10.0.0.76/30 table ntk
lxc exec mu -- ip route del 10.0.0.60/30 table ntk
lxc exec mu -- ip route del 10.0.0.8/31 table ntk
lxc exec mu -- ip route del 10.0.0.72/31 table ntk
lxc exec mu -- ip route del 10.0.0.56/31 table ntk
lxc exec mu -- ip route del 10.0.0.48/31 table ntk
lxc exec mu -- ip route del 10.0.0.10/32 table ntk
lxc exec mu -- ip route del 10.0.0.74/32 table ntk
lxc exec mu -- ip route del 10.0.0.58/32 table ntk
lxc exec mu -- ip route del 10.0.0.50/32 table ntk
lxc exec mu -- ip route del 10.0.0.40/32 table ntk

lxc exec mu -- iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.11
lxc exec mu -- ip address del 10.0.0.11/32 dev eth1
lxc exec mu -- ip address del 10.0.0.75/32 dev eth1
lxc exec mu -- ip address del 10.0.0.59/32 dev eth1
lxc exec mu -- ip address del 10.0.0.51/32 dev eth1
lxc exec mu -- ip address del 10.0.0.41/32 dev eth1

lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.24/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.88/29 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.12/30 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.76/30 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.60/30 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.8/31 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.72/31 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.56/31 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.48/31 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.10/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.74/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.58/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.50/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.40/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.11/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.75/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.59/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.51/32 table ntk
lxc exec mu -- ip netns exec entr01 ip route change unreachable 10.0.0.41/32 table ntk

lxc exec mu -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.24/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.88/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.30/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.94/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.62/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.50/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.28/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.92/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.60/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.48/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.40/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.29/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.93/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.61/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.49/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.41/32 table ntk

(echo; echo "250 ntk_from_00:16:3E:1A:C4:45 # xxx_table_ntk_from_00:16:3E:1A:C4:45_xxx") | lxc exec mu -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec mu -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.16/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.80/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.24/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.88/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.30/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.94/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.28/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.92/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.60/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.48/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.29/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.93/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.24/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.88/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.30/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.94/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.62/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.50/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.28/32 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.92/32 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.60/32 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.48/32 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.40/32 table ntk
lxc exec mu -- ip route change 10.0.0.29/32 table ntk via 169.254.253.216 dev eth1
lxc exec mu -- ip route change 10.0.0.93/32 table ntk via 169.254.253.216 dev eth1
lxc exec mu -- ip route change 10.0.0.61/32 table ntk via 169.254.253.216 dev eth1
lxc exec mu -- ip route change 10.0.0.49/32 table ntk via 169.254.253.216 dev eth1
lxc exec mu -- ip route change 10.0.0.41/32 table ntk via 169.254.253.216 dev eth1
lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.28/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.92/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.29/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.93/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:1A:C4:45 -j MARK --set-mark 250
lxc exec mu -- ip rule add fwmark 250 table ntk_from_00:16:3E:1A:C4:45

(echo; echo "250 ntk_from_00:16:3E:2D:8D:DE # xxx_table_ntk_from_00:16:3E:2D:8D:DE_xxx") | lxc exec delta -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec delta -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.16/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.80/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.24/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.88/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.30/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.94/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.28/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.92/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.28/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.92/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.24/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.88/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.30/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.94/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.62/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.50/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.28/32 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.92/32 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.60/32 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.48/32 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.40/32 table ntk
lxc exec delta -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:2D:8D:DE -j MARK --set-mark 250
lxc exec delta -- ip rule add fwmark 250 table ntk_from_00:16:3E:2D:8D:DE

lxc exec mu -- ip address add 10.0.0.28 dev eth1
lxc exec mu -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.28
lxc exec mu -- ip address add 10.0.0.92 dev eth1
lxc exec mu -- ip address add 10.0.0.60 dev eth1
lxc exec mu -- ip address add 10.0.0.48 dev eth1
lxc exec mu -- ip address add 10.0.0.40 dev eth1
lxc exec mu -- ip route del 10.0.0.28/32 table ntk
lxc exec mu -- ip route del 10.0.0.92/32 table ntk
lxc exec mu -- ip route del 10.0.0.60/32 table ntk
lxc exec mu -- ip route del 10.0.0.48/32 table ntk
lxc exec mu -- ip route del 10.0.0.40/32 table ntk
lxc exec mu -- ip route del 10.0.0.28/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.92/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.60/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.48/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.40/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.24/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.88/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.30/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.94/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.62/31 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.50/31 table ntk
lxc exec mu -- ip route change 10.0.0.29/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.28
lxc exec mu -- ip route change 10.0.0.93/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.28
lxc exec mu -- ip route change 10.0.0.61/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
lxc exec mu -- ip route change 10.0.0.49/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.48
lxc exec mu -- ip route change 10.0.0.41/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.40
lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.29/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.93/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45

lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.28/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.92/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.16/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.80/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.24/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.88/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.30/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.94/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.62/31 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.50/31 table ntk
lxc exec delta -- ip route change 10.0.0.28/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.29
lxc exec delta -- ip route change 10.0.0.92/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.29
lxc exec delta -- ip route change 10.0.0.60/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.61
lxc exec delta -- ip route change 10.0.0.48/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.49
lxc exec delta -- ip route change 10.0.0.40/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.41

lxc exec mu -- ip netns exec entr01 ip route flush table main
lxc exec mu -- ip netns exec entr01 ip link delete entr01_eth1 type macvlan
lxc exec mu -- ip netns del entr01

lxc exec delta -- ip route del 169.254.101.161 dev eth1 src 169.254.253.216

echo "mu vede delta e viceversa"
lxc exec mu -- ping -q -n -c 1 10.0.0.29 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.29"; exit 1)
lxc exec mu -- ping -q -n -c 1 10.0.0.93 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.93"; exit 1)
lxc exec mu -- ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.61"; exit 1)
lxc exec mu -- ping -q -n -c 1 10.0.0.49 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.49"; exit 1)
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Ingresso del g-nodo 𝜇+𝛿 in G𝛾"

# Durante queste operazioni, il sistema *𝛿* deve mantenersi sempre in grado di comunicare con *𝜇*.
# tramite l'indirizzo IP interno al g-nodo di livello 1. Per questo ogni tanto mettiamo un comando di ping.

echo "arco tra *𝛿* e *𝛾*:"

lxc exec delta -- ip route add 169.254.94.223 dev eth1 src 169.254.253.216
lxc exec gamma -- ip route add 169.254.253.216 dev eth1 src 169.254.94.223
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Nei sistemi *𝜇* e *𝛿* le vecchie identità si spostano in un namespace"

lxc exec delta -- ip netns add entr03
lxc exec delta -- ip netns exec entr03 sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec delta -- ip netns exec entr03 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec delta -- ip link add dev entr03_eth1 link eth1 type macvlan
lxc exec delta -- ip link set dev entr03_eth1 netns entr03
lxc exec delta -- ip netns exec entr03 ip link set dev entr03_eth1 address 00:16:3E:B9:77:80
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.rp_filter=0 &>/dev/null
lxc exec delta -- ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.arp_ignore=1 &>/dev/null
lxc exec delta -- ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.arp_announce=2 &>/dev/null
lxc exec delta -- ip netns exec entr03 ip link set dev entr03_eth1 up
lxc exec delta -- ip netns exec entr03 ip address add 169.254.83.167 dev entr03_eth1
lxc exec delta -- ip netns exec entr03 ip route add 169.254.242.91 dev entr03_eth1 src 169.254.83.167
lxc exec delta -- ip netns exec entr03 ip route add 169.254.94.223 dev entr03_eth1 src 169.254.83.167
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

lxc exec mu -- ip netns add entr03
lxc exec mu -- ip netns exec entr03 sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec mu -- ip netns exec entr03 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec mu -- ip link add dev entr03_eth1 link eth1 type macvlan
lxc exec mu -- ip link set dev entr03_eth1 netns entr03
lxc exec mu -- ip netns exec entr03 ip link set dev entr03_eth1 address 00:16:3E:DF:23:F5
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.rp_filter=0 &>/dev/null
lxc exec mu -- ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.arp_ignore=1 &>/dev/null
lxc exec mu -- ip netns exec entr03 sysctl net.ipv4.conf.entr03_eth1.arp_announce=2 &>/dev/null
lxc exec mu -- ip netns exec entr03 ip link set dev entr03_eth1 up
lxc exec mu -- ip netns exec entr03 ip address add 169.254.242.91 dev entr03_eth1
lxc exec mu -- ip netns exec entr03 ip route add 169.254.83.167 dev entr03_eth1 src 169.254.242.91
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

lxc exec gamma -- ip route add 169.254.83.167 dev eth1 src 169.254.94.223

lxc exec delta -- ip netns exec entr03 ip rule add table ntk
(echo; echo "249 ntk_from_00:16:3E:DF:23:F5 # xxx_table_ntk_from_00:16:3E:DF:23:F5_xxx") | lxc exec delta -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec delta -- ip netns exec entr03 iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:DF:23:F5 -j MARK --set-mark 249
lxc exec delta -- ip netns exec entr03 ip rule add fwmark 249 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.40/32 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:DF:23:F5
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip route del 10.0.0.28/32 table ntk
lxc exec delta -- ip route del 10.0.0.92/32 table ntk
lxc exec delta -- ip route del 10.0.0.60/32 table ntk
lxc exec delta -- ip route del 10.0.0.48/32 table ntk
lxc exec delta -- ip route del 10.0.0.28/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.92/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.16/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.80/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.24/30 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.88/30 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.56/30 table ntk
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.30/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.94/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.62/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.50/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.28/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.92/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.60/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.48/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.16/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.80/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.24/30 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.88/30 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.30/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.94/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.28/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.92/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip route del 10.0.0.0/29 table ntk
lxc exec delta -- ip route del 10.0.0.64/29 table ntk
lxc exec delta -- ip route del 10.0.0.8/29 table ntk
lxc exec delta -- ip route del 10.0.0.72/29 table ntk
lxc exec delta -- ip route del 10.0.0.16/29 table ntk
lxc exec delta -- ip route del 10.0.0.80/29 table ntk
lxc exec delta -- ip route del 10.0.0.24/30 table ntk
lxc exec delta -- ip route del 10.0.0.88/30 table ntk
lxc exec delta -- ip route del 10.0.0.56/30 table ntk
lxc exec delta -- ip route del 10.0.0.30/31 table ntk
lxc exec delta -- ip route del 10.0.0.94/31 table ntk
lxc exec delta -- ip route del 10.0.0.62/31 table ntk
lxc exec delta -- ip route del 10.0.0.50/31 table ntk
lxc exec delta -- ip route del 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.16/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.80/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.24/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.88/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.30/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.94/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.29
lxc exec delta -- ip address del 10.0.0.29/32 dev eth1
lxc exec delta -- ip address del 10.0.0.93/32 dev eth1
lxc exec delta -- ip address del 10.0.0.61/32 dev eth1
lxc exec delta -- ip address del 10.0.0.49/32 dev eth1
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.16/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.80/29 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.24/30 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.88/30 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.56/30 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.30/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.94/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.62/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.50/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.28/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.92/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.60/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.48/31 table ntk
lxc exec delta -- ip netns exec entr03 ip route change 10.0.0.40/32 table ntk via 169.254.242.91 dev entr03_eth1
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.28/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.92/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:DF:23:F5
lxc exec delta -- ip netns exec entr03 ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:DF:23:F5
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

lxc exec mu -- ip netns exec entr03 ip rule add table ntk
(echo; echo "249 ntk_from_00:16:3E:B9:77:80 # xxx_table_ntk_from_00:16:3E:B9:77:80_xxx") | lxc exec mu -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec mu -- ip netns exec entr03 iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:B9:77:80 -j MARK --set-mark 249
lxc exec mu -- ip netns exec entr03 ip rule add fwmark 249 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.41/32 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip route del 10.0.0.29/32 table ntk
lxc exec mu -- ip route del 10.0.0.93/32 table ntk
lxc exec mu -- ip route del 10.0.0.61/32 table ntk
lxc exec mu -- ip route del 10.0.0.49/32 table ntk
lxc exec mu -- ip route del 10.0.0.29/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.93/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.8/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.72/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.24/30 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.88/30 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.56/30 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.30/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.94/31 table ntk
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.62/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.50/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.28/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.92/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.60/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.48/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.16/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.80/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.24/30 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.88/30 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.30/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.94/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.28/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.92/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip route del 10.0.0.0/29 table ntk
lxc exec mu -- ip route del 10.0.0.64/29 table ntk
lxc exec mu -- ip route del 10.0.0.8/29 table ntk
lxc exec mu -- ip route del 10.0.0.72/29 table ntk
lxc exec mu -- ip route del 10.0.0.16/29 table ntk
lxc exec mu -- ip route del 10.0.0.80/29 table ntk
lxc exec mu -- ip route del 10.0.0.24/30 table ntk
lxc exec mu -- ip route del 10.0.0.88/30 table ntk
lxc exec mu -- ip route del 10.0.0.56/30 table ntk
lxc exec mu -- ip route del 10.0.0.30/31 table ntk
lxc exec mu -- ip route del 10.0.0.94/31 table ntk
lxc exec mu -- ip route del 10.0.0.62/31 table ntk
lxc exec mu -- ip route del 10.0.0.50/31 table ntk
lxc exec mu -- ip route del 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.16/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.80/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.24/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.88/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.30/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.94/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.28
lxc exec mu -- ip address del 10.0.0.28/32 dev eth1
lxc exec mu -- ip address del 10.0.0.92/32 dev eth1
lxc exec mu -- ip address del 10.0.0.60/32 dev eth1
lxc exec mu -- ip address del 10.0.0.48/32 dev eth1
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.8/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.72/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.16/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.80/29 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.24/30 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.88/30 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.56/30 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.30/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.94/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.62/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.50/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.28/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.92/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.60/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.48/31 table ntk
lxc exec mu -- ip netns exec entr03 ip route change 10.0.0.41/32 table ntk via 169.254.83.167 dev entr03_eth1
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.16/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.80/29 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.24/30 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.88/30 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.30/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.94/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.28/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.92/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ip netns exec entr03 ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:B9:77:80
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Nei sistemi *𝛿* e *𝜇* si instanziano nuovi QspnManager"

lxc exec delta -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.24/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.88/29 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.16/30 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.80/30 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.20/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.84/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.60/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.22/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.86/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.62/31 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.50/31 table ntk
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.22/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.86/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip address add 10.0.0.21 dev eth1
lxc exec delta -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.21
lxc exec delta -- ip address add 10.0.0.85 dev eth1
lxc exec delta -- ip address add 10.0.0.61 dev eth1
lxc exec delta -- ip address add 10.0.0.49 dev eth1
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip route del 10.0.0.20/31 table ntk
lxc exec delta -- ip route del 10.0.0.84/31 table ntk
lxc exec delta -- ip route del 10.0.0.60/31 table ntk
lxc exec delta -- ip route del 10.0.0.48/31 table ntk
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip route add unreachable 10.0.0.20/32 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.84/32 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.60/32 table ntk
lxc exec delta -- ip route add unreachable 10.0.0.48/32 table ntk
lxc exec delta -- ip route del 10.0.0.20/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.84/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.60/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route del 10.0.0.48/31 table ntk_from_00:16:3E:2D:8D:DE
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip route add unreachable 10.0.0.20/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.84/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route add unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

lxc exec mu -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.24/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.88/29 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.16/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.80/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.20/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.84/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.60/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.22/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.86/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.62/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.50/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.22/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.86/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip address add 10.0.0.20 dev eth1
lxc exec mu -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.20
lxc exec mu -- ip address add 10.0.0.84 dev eth1
lxc exec mu -- ip address add 10.0.0.60 dev eth1
lxc exec mu -- ip address add 10.0.0.48 dev eth1
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- ip route del 10.0.0.20/31 table ntk
lxc exec mu -- ip route del 10.0.0.84/31 table ntk
lxc exec mu -- ip route del 10.0.0.60/31 table ntk
lxc exec mu -- ip route del 10.0.0.48/31 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.21/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.85/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.61/32 table ntk
lxc exec mu -- ip route add unreachable 10.0.0.49/32 table ntk
lxc exec mu -- ip route del 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route del 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.21/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.85/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route add unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Il QspnManager del sistema *𝛾* riceve un nuovo arco, ma per ora nessun ETP da esso."

(echo; echo "249 ntk_from_00:16:3E:1A:C4:45 # xxx_table_ntk_from_00:16:3E:1A:C4:45_xxx") | lxc exec gamma -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec gamma -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45

echo "Il QspnManager del sistema *𝛿* riceve un ETP da *𝛾*."

(echo; echo "248 ntk_from_00:16:3E:5B:78:D5 # xxx_table_ntk_from_00:16:3E:5B:78:D5_xxx") | lxc exec delta -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec delta -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.22/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.86/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.62/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.50/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.20/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.84/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.60/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.48/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec delta -- ip route change 10.0.0.22/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.86/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.62/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.61
lxc exec delta -- ip route change 10.0.0.50/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.49
lxc exec delta -- ip route change 10.0.0.20/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.84/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.60/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.61
lxc exec delta -- ip route change 10.0.0.48/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.49
lxc exec delta -- ip route change 10.0.0.40/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.41
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.22/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.86/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change 10.0.0.20/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
lxc exec delta -- ip route change 10.0.0.84/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
lxc exec delta -- ip route change 10.0.0.60/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
lxc exec delta -- ip route change 10.0.0.48/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
lxc exec delta -- ip route change blackhole 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change 10.0.0.22/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.86/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change unreachable 10.0.0.20/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.84/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:5B:78:D5 -j MARK --set-mark 248
lxc exec delta -- ip rule add fwmark 248 table ntk_from_00:16:3E:5B:78:D5
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Il sistema *𝛿* propaga l'ETP a *𝜇*."

lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec mu -- ip route change 10.0.0.22/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.86/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.62/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
lxc exec mu -- ip route change 10.0.0.50/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.48
lxc exec mu -- ip route change 10.0.0.21/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.85/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.61/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
lxc exec mu -- ip route change 10.0.0.49/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.48
lxc exec mu -- ip route change 10.0.0.41/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.40
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)
lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.22/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.86/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.21/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.85/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "Il sistema *𝛿* invia un ETP a *𝛾*"

lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change blackhole 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change 10.0.0.41/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.40
lxc exec gamma -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:1A:C4:45 -j MARK --set-mark 249
lxc exec gamma -- ip rule add fwmark 249 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change blackhole 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec gamma -- ip route change 10.0.0.20/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.84/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.60/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.48/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change 10.0.0.41/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.40

echo "Il sistema *𝛽* vede arrivare un ETP da *𝛾* con il quale scopre un percorso verso la destinazione 2·1·0·."

lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec beta -- ip route change 10.0.0.20/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.84/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.60/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
lxc exec beta -- ip route change 10.0.0.48/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
lxc exec beta -- ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
lxc exec beta -- ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
lxc exec beta -- ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.41
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5

echo "identità di connettività possono essere dismesse."

lxc exec mu -- ip netns exec entr03 ip route flush table main
lxc exec mu -- ip netns exec entr03 ip link delete entr03_eth1 type macvlan
lxc exec mu -- ip netns del entr03
lxc exec mu -- sed -i '/xxx_table_ntk_from_00:16:3E:B9:77:80_xxx/d' /etc/iproute2/rt_tables

lxc exec delta -- ip netns exec entr03 ip route flush table main
lxc exec delta -- ip netns exec entr03 ip link delete entr03_eth1 type macvlan
lxc exec delta -- ip netns del entr03
lxc exec delta -- sed -i '/xxx_table_ntk_from_00:16:3E:DF:23:F5_xxx/d' /etc/iproute2/rt_tables

lxc exec gamma -- ip route del 169.254.83.167 dev eth1 src 169.254.94.223
lxc exec mu -- ping -q -n -c 1 10.0.0.41 -W 1 &>/dev/null || (echo "mu: errore ping 10.0.0.41"; exit 1)

echo "beta vede gamma delta e mu"
lxc exec beta -- ping -q -n -c 1 10.0.0.22 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.22"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.86 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.86"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.62"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.50 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.50"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.40 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.40"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.21 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.21"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.85 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.85"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.61"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.49 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.49"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.20"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.84"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.60"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.48"; exit 1)
echo "gamma vede delta e mu"
lxc exec gamma -- ping -q -n -c 1 10.0.0.21 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.21"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.85 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.85"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.61"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.49 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.49"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.20"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.84"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.60"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.48"; exit 1)
echo "delta vede mu"
lxc exec delta -- ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.20"; exit 1)
lxc exec delta -- ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.84"; exit 1)
lxc exec delta -- ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.60"; exit 1)
lxc exec delta -- ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.48"; exit 1)
lxc exec delta -- ping -q -n -c 1 10.0.0.40 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.40"; exit 1)

### Ingresso di 𝛼 in G𝛾
echo "Ingresso alfa in G-gamma"

lxc exec alfa -- ip route add 169.254.96.141 dev eth1 src 169.254.69.30

lxc exec beta -- ip route add 169.254.69.30 dev eth1 src 169.254.96.141

lxc exec alfa -- ip netns add entr04
lxc exec alfa -- ip netns exec entr04 sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec alfa -- ip netns exec entr04 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec alfa -- ip link add dev entr04_eth1 link eth1 type macvlan
lxc exec alfa -- ip link set dev entr04_eth1 netns entr04
lxc exec alfa -- ip netns exec entr04 ip link set dev entr04_eth1 address 00:16:3E:78:18:0B
lxc exec alfa -- ip netns exec entr04 sysctl net.ipv4.conf.entr04_eth1.rp_filter=0 &>/dev/null
lxc exec alfa -- ip netns exec entr04 sysctl net.ipv4.conf.entr04_eth1.arp_ignore=1 &>/dev/null
lxc exec alfa -- ip netns exec entr04 sysctl net.ipv4.conf.entr04_eth1.arp_announce=2 &>/dev/null
lxc exec alfa -- ip netns exec entr04 ip link set dev entr04_eth1 up
lxc exec alfa -- ip netns exec entr04 ip address add 169.254.202.128 dev entr04_eth1
lxc exec alfa -- ip netns exec entr04 ip route add 169.254.96.141 dev entr04_eth1 src 169.254.202.128

lxc exec beta -- ip route add 169.254.202.128 dev eth1 src 169.254.96.141

echo "alfa0 in network namespace entr04"
lxc exec alfa -- ip netns exec entr04 ip rule add table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.0/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.64/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.8/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.72/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.16/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.80/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.28/30 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.92/30 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.60/30 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.24/31 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.88/31 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.56/31 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.48/31 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.27/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.91/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.59/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.51/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.41/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.26/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.90/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.58/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.50/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route add unreachable 10.0.0.40/32 table ntk
lxc exec alfa -- ip route del 10.0.0.0/29 table ntk
lxc exec alfa -- ip route del 10.0.0.64/29 table ntk
lxc exec alfa -- ip route del 10.0.0.8/29 table ntk
lxc exec alfa -- ip route del 10.0.0.72/29 table ntk
lxc exec alfa -- ip route del 10.0.0.16/29 table ntk
lxc exec alfa -- ip route del 10.0.0.80/29 table ntk
lxc exec alfa -- ip route del 10.0.0.28/30 table ntk
lxc exec alfa -- ip route del 10.0.0.92/30 table ntk
lxc exec alfa -- ip route del 10.0.0.60/30 table ntk
lxc exec alfa -- ip route del 10.0.0.24/31 table ntk
lxc exec alfa -- ip route del 10.0.0.88/31 table ntk
lxc exec alfa -- ip route del 10.0.0.56/31 table ntk
lxc exec alfa -- ip route del 10.0.0.48/31 table ntk
lxc exec alfa -- ip route del 10.0.0.27/32 table ntk
lxc exec alfa -- ip route del 10.0.0.91/32 table ntk
lxc exec alfa -- ip route del 10.0.0.59/32 table ntk
lxc exec alfa -- ip route del 10.0.0.51/32 table ntk
lxc exec alfa -- ip route del 10.0.0.41/32 table ntk
lxc exec alfa -- iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.26
lxc exec alfa -- ip address del 10.0.0.26/32 dev eth1
lxc exec alfa -- ip address del 10.0.0.90/32 dev eth1
lxc exec alfa -- ip address del 10.0.0.58/32 dev eth1
lxc exec alfa -- ip address del 10.0.0.50/32 dev eth1
lxc exec alfa -- ip address del 10.0.0.40/32 dev eth1
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.0/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.64/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.8/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.72/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.16/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.80/29 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.28/30 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.92/30 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.60/30 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.24/31 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.88/31 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.56/31 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.48/31 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.27/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.91/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.59/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.51/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.41/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.26/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.90/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.58/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.50/32 table ntk
lxc exec alfa -- ip netns exec entr04 ip route change unreachable 10.0.0.40/32 table ntk

echo "alfa1 in G-gamma"
# alfa start
lxc exec alfa -- ip address add 10.0.0.50 dev eth1
lxc exec alfa -- ip address add 10.0.0.40 dev eth1
lxc exec alfa -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.24/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.88/29 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.16/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.80/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.20/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.84/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.60/30 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.51/32 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.41/32 table ntk
# alfa new arc
(echo; echo "250 ntk_from_00:16:3E:EC:A3:E1 # xxx_table_ntk_from_00:16:3E:EC:A3:E1_xxx") | lxc exec alfa -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec alfa -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.20/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.84/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.60/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
# beta new arc
(echo; echo "249 ntk_from_00:16:3E:FD:E2:AA # xxx_table_ntk_from_00:16:3E:FD:E2:AA_xxx") | lxc exec beta -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec beta -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.22/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.86/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.62/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.50/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:FD:E2:AA
# alfa gets ETP from beta
lxc exec alfa -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.16/30 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.80/30 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.56/30 table ntk
lxc exec alfa -- ip route change 10.0.0.20/30 table ntk via 169.254.96.141 dev eth1
lxc exec alfa -- ip route change 10.0.0.84/30 table ntk via 169.254.96.141 dev eth1
lxc exec alfa -- ip route change 10.0.0.60/30 table ntk via 169.254.96.141 dev eth1
lxc exec alfa -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.51/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.41/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.20/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.84/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.60/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:EC:A3:E1 -j MARK --set-mark 250
lxc exec alfa -- ip rule add fwmark 250 table ntk_from_00:16:3E:EC:A3:E1
# alfa gets real address
lxc exec alfa -- ip address add 10.0.0.18 dev eth1
lxc exec alfa -- iptables -t nat -A POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.18
lxc exec alfa -- ip address add 10.0.0.82 dev eth1
lxc exec alfa -- ip address add 10.0.0.58 dev eth1
lxc exec alfa -- ip route del 10.0.0.16/30 table ntk
lxc exec alfa -- ip route del 10.0.0.80/30 table ntk
lxc exec alfa -- ip route del 10.0.0.56/30 table ntk
lxc exec alfa -- ip route del 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route del 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route del 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.16/31 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.80/31 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.56/31 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.19/32 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.83/32 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.59/32 table ntk
lxc exec alfa -- ip route add unreachable 10.0.0.16/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.80/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.56/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.19/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.83/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route add unreachable 10.0.0.59/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec alfa -- ip route change 10.0.0.20/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.18
lxc exec alfa -- ip route change 10.0.0.84/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.18
lxc exec alfa -- ip route change 10.0.0.60/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.58
lxc exec alfa -- ip route change unreachable 10.0.0.16/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.80/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.56/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.19/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.83/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.59/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.51/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.41/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.20/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.84/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.60/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.16/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.80/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.56/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.19/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.83/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.59/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
# beta gets ETP from alfa
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip route change 10.0.0.16/30 table ntk via 169.254.69.30 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.80/30 table ntk via 169.254.69.30 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.56/30 table ntk via 169.254.69.30 dev eth1 src 10.0.0.63
lxc exec beta -- ip route change 10.0.0.20/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.84/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.60/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
lxc exec beta -- ip route change 10.0.0.48/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
lxc exec beta -- ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.23
lxc exec beta -- ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.63
lxc exec beta -- ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.51
lxc exec beta -- ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev eth1 src 10.0.0.41
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev eth1
lxc exec beta -- ip route change 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev eth1
lxc exec beta -- ip route change 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev eth1
lxc exec beta -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change 10.0.0.20/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
lxc exec beta -- ip route change 10.0.0.84/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
lxc exec beta -- ip route change 10.0.0.60/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
lxc exec beta -- ip route change blackhole 10.0.0.48/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change 10.0.0.22/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
lxc exec beta -- ip route change 10.0.0.86/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
lxc exec beta -- ip route change 10.0.0.62/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev eth1
lxc exec beta -- ip route change blackhole 10.0.0.50/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route change blackhole 10.0.0.40/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:FD:E2:AA -j MARK --set-mark 249
lxc exec beta -- ip rule add fwmark 249 table ntk_from_00:16:3E:FD:E2:AA
# gamma gets ETP from beta
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec gamma -- ip route change 10.0.0.16/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.80/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.56/30 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.20/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.84/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.60/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.48/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change 10.0.0.41/32 table ntk via 169.254.96.141 dev eth1 src 10.0.0.40
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
lxc exec gamma -- ip route change 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
lxc exec gamma -- ip route change 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.96.141 dev eth1
lxc exec gamma -- ip route change blackhole 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change 10.0.0.20/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1
lxc exec gamma -- ip route change 10.0.0.84/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1
lxc exec gamma -- ip route change 10.0.0.60/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1
lxc exec gamma -- ip route change 10.0.0.48/31 table ntk_from_00:16:3E:EC:A3:E1 via 169.254.253.216 dev eth1
lxc exec gamma -- ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EC:A3:E1
# delta gets ETP from gamma
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec delta -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec delta -- ip route change 10.0.0.16/30 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.80/30 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.56/30 table ntk via 169.254.94.223 dev eth1 src 10.0.0.61
lxc exec delta -- ip route change 10.0.0.22/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.86/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.62/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.61
lxc exec delta -- ip route change 10.0.0.50/31 table ntk via 169.254.94.223 dev eth1 src 10.0.0.49
lxc exec delta -- ip route change 10.0.0.20/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.84/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.21
lxc exec delta -- ip route change 10.0.0.60/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.61
lxc exec delta -- ip route change 10.0.0.48/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.49
lxc exec delta -- ip route change 10.0.0.40/32 table ntk via 169.254.119.176 dev eth1 src 10.0.0.41
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.22/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.86/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change 10.0.0.20/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
lxc exec delta -- ip route change 10.0.0.84/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
lxc exec delta -- ip route change 10.0.0.60/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
lxc exec delta -- ip route change 10.0.0.48/32 table ntk_from_00:16:3E:5B:78:D5 via 169.254.119.176 dev eth1
lxc exec delta -- ip route change blackhole 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec delta -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change 10.0.0.16/30 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.80/30 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.56/30 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.22/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.86/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.62/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change 10.0.0.50/31 table ntk_from_00:16:3E:2D:8D:DE via 169.254.94.223 dev eth1
lxc exec delta -- ip route change unreachable 10.0.0.20/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.84/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.60/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.48/32 table ntk_from_00:16:3E:2D:8D:DE
lxc exec delta -- ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:2D:8D:DE
# mu gets ETP from delta
lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec mu -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec mu -- ip route change 10.0.0.16/30 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.80/30 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.56/30 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
lxc exec mu -- ip route change 10.0.0.22/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.86/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.62/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
lxc exec mu -- ip route change 10.0.0.50/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.48
lxc exec mu -- ip route change 10.0.0.21/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.85/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.20
lxc exec mu -- ip route change 10.0.0.61/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.60
lxc exec mu -- ip route change 10.0.0.49/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.48
lxc exec mu -- ip route change 10.0.0.41/32 table ntk via 169.254.253.216 dev eth1 src 10.0.0.40
lxc exec mu -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.22/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.86/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.62/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.50/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.21/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.85/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.61/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.49/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec mu -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45

echo "alfa0 dismessa"
lxc exec alfa -- ip netns exec entr04 ip route flush table main
lxc exec alfa -- ip netns exec entr04 ip link delete entr04_eth1 type macvlan
lxc exec alfa -- ip netns del entr04

lxc exec beta -- ip route del 169.254.202.128 dev eth1 src 169.254.96.141

echo "alfa vede beta gamma delta e mu"
lxc exec alfa -- ping -q -n -c 1 10.0.0.23 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.23"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.87 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.87"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.63 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.63"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.22 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.22"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.86 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.86"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.21 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.21"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.85 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.85"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.61"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.20"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.84"; exit 1)
lxc exec alfa -- ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.60"; exit 1)
echo "beta vede gamma delta e mu"
lxc exec beta -- ping -q -n -c 1 10.0.0.22 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.22"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.86 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.86"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.62"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.50 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.50"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.40 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.40"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.21 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.21"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.85 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.85"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.61"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.49 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.49"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.20"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.84"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.60"; exit 1)
lxc exec beta -- ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null || (echo "beta: errore ping 10.0.0.48"; exit 1)
echo "gamma vede delta e mu"
lxc exec gamma -- ping -q -n -c 1 10.0.0.21 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.21"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.85 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.85"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.61 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.61"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.49 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.49"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.20"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.84"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.60"; exit 1)
lxc exec gamma -- ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null || (echo "gamma: errore ping 10.0.0.48"; exit 1)
echo "delta vede mu"
lxc exec delta -- ping -q -n -c 1 10.0.0.20 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.20"; exit 1)
lxc exec delta -- ping -q -n -c 1 10.0.0.84 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.84"; exit 1)
lxc exec delta -- ping -q -n -c 1 10.0.0.60 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.60"; exit 1)
lxc exec delta -- ping -q -n -c 1 10.0.0.48 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.48"; exit 1)
lxc exec delta -- ping -q -n -c 1 10.0.0.40 -W 1 &>/dev/null || (echo "delta: errore ping 10.0.0.40"; exit 1)

echo "Arco tra *𝜀* e *𝛽*"

lxc exec epsilon -- ip route add 169.254.96.141 dev eth1 src 169.254.163.36

lxc exec beta -- ip route add 169.254.163.36 dev eth1 src 169.254.96.141

echo "Ingresso di *𝜀* - Prima fase"

lxc exec epsilon -- ip netns add entr05
lxc exec epsilon -- ip netns exec entr05 sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec epsilon -- ip netns exec entr05 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec epsilon -- ip link add dev entr05_eth1 link eth1 type macvlan
lxc exec epsilon -- ip link set dev entr05_eth1 netns entr05
lxc exec epsilon -- ip netns exec entr05 ip link set dev entr05_eth1 address 00:16:3E:13:28:B2
lxc exec epsilon -- ip netns exec entr05 sysctl net.ipv4.conf.entr05_eth1.rp_filter=0 &>/dev/null
lxc exec epsilon -- ip netns exec entr05 sysctl net.ipv4.conf.entr05_eth1.arp_ignore=1 &>/dev/null
lxc exec epsilon -- ip netns exec entr05 sysctl net.ipv4.conf.entr05_eth1.arp_announce=2 &>/dev/null
lxc exec epsilon -- ip netns exec entr05 ip link set dev entr05_eth1 up
lxc exec epsilon -- ip netns exec entr05 ip address add 169.254.133.31 dev entr05_eth1
lxc exec epsilon -- ip netns exec entr05 ip route add 169.254.96.141 dev entr05_eth1 src 169.254.133.31

lxc exec beta -- ip route add 169.254.133.31 dev eth1 src 169.254.96.141

lxc exec epsilon -- ip netns exec entr05 ip rule add table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.0/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.64/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.8/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.72/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.16/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.80/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.24/30 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.88/30 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.56/30 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.30/31 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.94/31 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.62/31 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.50/31 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.28/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.92/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.60/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.48/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.40/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.29/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.93/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.61/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.49/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route add unreachable 10.0.0.41/32 table ntk
lxc exec epsilon -- ip route del 10.0.0.0/29 table ntk
lxc exec epsilon -- ip route del 10.0.0.64/29 table ntk
lxc exec epsilon -- ip route del 10.0.0.8/29 table ntk
lxc exec epsilon -- ip route del 10.0.0.72/29 table ntk
lxc exec epsilon -- ip route del 10.0.0.16/29 table ntk
lxc exec epsilon -- ip route del 10.0.0.80/29 table ntk
lxc exec epsilon -- ip route del 10.0.0.24/30 table ntk
lxc exec epsilon -- ip route del 10.0.0.88/30 table ntk
lxc exec epsilon -- ip route del 10.0.0.56/30 table ntk
lxc exec epsilon -- ip route del 10.0.0.30/31 table ntk
lxc exec epsilon -- ip route del 10.0.0.94/31 table ntk
lxc exec epsilon -- ip route del 10.0.0.62/31 table ntk
lxc exec epsilon -- ip route del 10.0.0.50/31 table ntk
lxc exec epsilon -- ip route del 10.0.0.29/32 table ntk
lxc exec epsilon -- ip route del 10.0.0.93/32 table ntk
lxc exec epsilon -- ip route del 10.0.0.61/32 table ntk
lxc exec epsilon -- ip route del 10.0.0.49/32 table ntk
lxc exec epsilon -- ip route del 10.0.0.41/32 table ntk
lxc exec epsilon -- iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.28
lxc exec epsilon -- ip address del 10.0.0.28/32 dev eth1
lxc exec epsilon -- ip address del 10.0.0.92/32 dev eth1
lxc exec epsilon -- ip address del 10.0.0.60/32 dev eth1
lxc exec epsilon -- ip address del 10.0.0.48/32 dev eth1
lxc exec epsilon -- ip address del 10.0.0.40/32 dev eth1
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.0/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.64/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.8/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.72/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.16/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.80/29 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.24/30 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.88/30 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.56/30 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.30/31 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.94/31 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.62/31 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.50/31 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.28/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.92/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.60/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.48/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.40/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.29/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.93/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.61/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.49/32 table ntk
lxc exec epsilon -- ip netns exec entr05 ip route change unreachable 10.0.0.41/32 table ntk

lxc exec epsilon -- ip route add unreachable 10.0.0.0/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.64/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.8/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.72/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.24/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.88/29 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.16/30 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.80/30 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.56/30 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.20/31 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.84/31 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.60/31 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.48/31 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.22/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.86/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.62/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.50/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.40/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.23/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.87/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.63/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.51/32 table ntk
lxc exec epsilon -- ip route add unreachable 10.0.0.41/32 table ntk

echo "Migrazione di *𝛽*"

# Durante queste operazioni, il sistema *𝛼* deve mantenersi sempre in grado di comunicare con *𝛾*
# tramite l'indirizzo IP interno al g-nodo di livello 3. Per questo ogni tanto mettiamo un comando di ping.

lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)
lxc exec beta -- ip netns add migr01
lxc exec beta -- ip netns exec migr01 sysctl net.ipv4.ip_forward=1 &>/dev/null
lxc exec beta -- ip netns exec migr01 sysctl net.ipv4.conf.all.rp_filter=0 &>/dev/null
lxc exec beta -- ip link add dev migr01_eth1 link eth1 type macvlan
lxc exec beta -- ip link set dev migr01_eth1 netns migr01
lxc exec beta -- ip netns exec migr01 ip link set dev migr01_eth1 address 00:16:3E:EE:AF:D1
lxc exec beta -- ip netns exec migr01 sysctl net.ipv4.conf.migr01_eth1.rp_filter=0 &>/dev/null
lxc exec beta -- ip netns exec migr01 sysctl net.ipv4.conf.migr01_eth1.arp_ignore=1 &>/dev/null
lxc exec beta -- ip netns exec migr01 sysctl net.ipv4.conf.migr01_eth1.arp_announce=2 &>/dev/null
lxc exec beta -- ip netns exec migr01 ip link set dev migr01_eth1 up
lxc exec beta -- ip netns exec migr01 ip address add 169.254.27.218 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route add 169.254.69.30 dev migr01_eth1 src 169.254.27.218
lxc exec beta -- ip netns exec migr01 ip route add 169.254.94.223 dev migr01_eth1 src 169.254.27.218
lxc exec beta -- ip netns exec migr01 ip route add 169.254.163.36 dev migr01_eth1 src 169.254.27.218
lxc exec beta -- ip netns exec migr01 ip route add 169.254.133.31 dev migr01_eth1 src 169.254.27.218
lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)

lxc exec alfa -- ip route add 169.254.27.218 dev eth1 src 169.254.69.30

lxc exec gamma -- ip route add 169.254.27.218 dev eth1 src 169.254.94.223

lxc exec epsilon -- ip route add 169.254.27.218 dev eth1 src 169.254.163.36
lxc exec epsilon -- ip netns exec entr05 ip route add 169.254.27.218 dev entr05_eth1 src 169.254.133.31

lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)
lxc exec beta -- ip netns exec migr01 ip rule add table ntk
lxc exec beta -- ip netns exec migr01 iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:5B:78:D5 -j MARK --set-mark 250
lxc exec beta -- ip netns exec migr01 ip rule add fwmark 250 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:FD:E2:AA -j MARK --set-mark 249
lxc exec beta -- ip netns exec migr01 ip rule add fwmark 249 table ntk_from_00:16:3E:FD:E2:AA

lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.8/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.72/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.16/30 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.80/30 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.56/30 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.20/31 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.84/31 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.60/31 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.48/31 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.22/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.86/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.62/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.50/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.40/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.23/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.87/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.63/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.51/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.41/32 table ntk

lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:5B:78:D5

lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.22/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.86/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.62/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.50/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.40/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:FD:E2:AA

lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.0/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.64/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.8/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.72/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.24/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.88/29 table ntk
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.16/30 table ntk via 169.254.69.30 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.80/30 table ntk via 169.254.69.30 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.56/30 table ntk via 169.254.69.30 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.20/31 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.84/31 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.60/31 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.48/31 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.22/32 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.86/32 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.62/32 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.50/32 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.40/32 table ntk via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.23/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.87/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.63/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.51/32 table ntk
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.41/32 table ntk

lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5 via 169.254.69.30 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:5B:78:D5

lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.20/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.84/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.60/31 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change blackhole 10.0.0.48/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.22/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.86/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change 10.0.0.62/32 table ntk_from_00:16:3E:FD:E2:AA via 169.254.94.223 dev migr01_eth1
lxc exec beta -- ip netns exec migr01 ip route change blackhole 10.0.0.50/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change blackhole 10.0.0.40/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change blackhole 10.0.0.51/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip netns exec migr01 ip route change blackhole 10.0.0.41/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)

echo "i vicini di 𝛽 modificano le rotte che passano per 𝛽1"

lxc exec gamma -- ip rule del fwmark 250 table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- ip route flush table ntk_from_00:16:3E:EC:A3:E1
lxc exec gamma -- sed -i '/xxx_table_ntk_from_00:16:3E:EC:A3:E1_xxx/d' /etc/iproute2/rt_tables
lxc exec gamma -- iptables -t mangle -D PREROUTING -m mac --mac-source 00:16:3E:EC:A3:E1 -j MARK --set-mark 250

(echo; echo "250 ntk_from_00:16:3E:EE:AF:D1 # xxx_table_ntk_from_00:16:3E:EE:AF:D1_xxx") | lxc exec gamma -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec gamma -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.20/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.84/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.60/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:EE:AF:D1 -j MARK --set-mark 250

lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec gamma -- ip route change 10.0.0.16/30 table ntk via 169.254.27.218 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.80/30 table ntk via 169.254.27.218 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.56/30 table ntk via 169.254.27.218 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.20/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.84/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.60/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.48/31 table ntk via 169.254.253.216 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk via 169.254.27.218 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk via 169.254.27.218 dev eth1 src 10.0.0.22
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk via 169.254.27.218 dev eth1 src 10.0.0.62
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk via 169.254.27.218 dev eth1 src 10.0.0.50
lxc exec gamma -- ip route change 10.0.0.41/32 table ntk via 169.254.27.218 dev eth1 src 10.0.0.40
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change 10.0.0.16/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.27.218 dev eth1
lxc exec gamma -- ip route change 10.0.0.80/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.27.218 dev eth1
lxc exec gamma -- ip route change 10.0.0.56/30 table ntk_from_00:16:3E:1A:C4:45 via 169.254.27.218 dev eth1
lxc exec gamma -- ip route change unreachable 10.0.0.20/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.84/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.60/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change 10.0.0.23/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.27.218 dev eth1
lxc exec gamma -- ip route change 10.0.0.87/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.27.218 dev eth1
lxc exec gamma -- ip route change 10.0.0.63/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.27.218 dev eth1
lxc exec gamma -- ip route change 10.0.0.51/32 table ntk_from_00:16:3E:1A:C4:45 via 169.254.27.218 dev eth1
lxc exec gamma -- ip route change blackhole 10.0.0.41/32 table ntk_from_00:16:3E:1A:C4:45
lxc exec gamma -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.16/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.80/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.56/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change 10.0.0.20/31 table ntk_from_00:16:3E:EE:AF:D1 via 169.254.253.216 dev eth1
lxc exec gamma -- ip route change 10.0.0.84/31 table ntk_from_00:16:3E:EE:AF:D1 via 169.254.253.216 dev eth1
lxc exec gamma -- ip route change 10.0.0.60/31 table ntk_from_00:16:3E:EE:AF:D1 via 169.254.253.216 dev eth1
lxc exec gamma -- ip route change 10.0.0.48/31 table ntk_from_00:16:3E:EE:AF:D1 via 169.254.253.216 dev eth1
lxc exec gamma -- ip route change unreachable 10.0.0.23/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.87/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.63/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec gamma -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EE:AF:D1

lxc exec gamma -- ip rule add fwmark 250 table ntk_from_00:16:3E:EE:AF:D1

lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)

lxc exec alfa -- ip rule del fwmark 250 table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- ip route flush table ntk_from_00:16:3E:EC:A3:E1
lxc exec alfa -- sed -i '/xxx_table_ntk_from_00:16:3E:EC:A3:E1_xxx/d' /etc/iproute2/rt_tables
lxc exec alfa -- iptables -t mangle -D PREROUTING -m mac --mac-source 00:16:3E:EC:A3:E1 -j MARK --set-mark 250

(echo; echo "250 ntk_from_00:16:3E:EE:AF:D1 # xxx_table_ntk_from_00:16:3E:EE:AF:D1_xxx") | lxc exec alfa -- tee -a /etc/iproute2/rt_tables >/dev/null
lxc exec alfa -- ip route add unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.20/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.84/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.60/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.16/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.80/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.56/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.19/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.83/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.59/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route add unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- iptables -t mangle -A PREROUTING -m mac --mac-source 00:16:3E:EE:AF:D1 -j MARK --set-mark 250

lxc exec alfa -- ip route change unreachable 10.0.0.0/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.64/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.8/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.72/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.24/29 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.88/29 table ntk
lxc exec alfa -- ip route change 10.0.0.20/30 table ntk via 169.254.27.218 dev eth1 src 10.0.0.18
lxc exec alfa -- ip route change 10.0.0.84/30 table ntk via 169.254.27.218 dev eth1 src 10.0.0.18
lxc exec alfa -- ip route change 10.0.0.60/30 table ntk via 169.254.27.218 dev eth1 src 10.0.0.58
lxc exec alfa -- ip route change unreachable 10.0.0.16/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.80/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.56/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.48/31 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.19/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.83/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.59/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.51/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.41/32 table ntk
lxc exec alfa -- ip route change unreachable 10.0.0.0/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.64/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.8/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.72/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.24/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.88/29 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.20/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.84/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.60/30 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.16/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.80/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.56/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.48/31 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.19/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.83/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.59/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.51/32 table ntk_from_00:16:3E:EE:AF:D1
lxc exec alfa -- ip route change unreachable 10.0.0.41/32 table ntk_from_00:16:3E:EE:AF:D1

lxc exec alfa -- ip rule add fwmark 250 table ntk_from_00:16:3E:EE:AF:D1

lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)

echo "𝛽 prosegue la migrazione"
lxc exec beta -- ip route del 10.0.0.0/29 table ntk
lxc exec beta -- ip route del 10.0.0.64/29 table ntk
lxc exec beta -- ip route del 10.0.0.8/29 table ntk
lxc exec beta -- ip route del 10.0.0.72/29 table ntk
lxc exec beta -- ip route del 10.0.0.24/29 table ntk
lxc exec beta -- ip route del 10.0.0.88/29 table ntk
lxc exec beta -- ip route del 10.0.0.16/30 table ntk
lxc exec beta -- ip route del 10.0.0.80/30 table ntk
lxc exec beta -- ip route del 10.0.0.56/30 table ntk
lxc exec beta -- ip route del 10.0.0.20/31 table ntk
lxc exec beta -- ip route del 10.0.0.84/31 table ntk
lxc exec beta -- ip route del 10.0.0.60/31 table ntk
lxc exec beta -- ip route del 10.0.0.48/31 table ntk
lxc exec beta -- ip route del 10.0.0.22/32 table ntk
lxc exec beta -- ip route del 10.0.0.86/32 table ntk
lxc exec beta -- ip route del 10.0.0.62/32 table ntk
lxc exec beta -- ip route del 10.0.0.50/32 table ntk
lxc exec beta -- ip route del 10.0.0.40/32 table ntk
lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)

lxc exec beta -- ip route del 10.0.0.0/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.64/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.8/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.72/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.24/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.88/29 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.16/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.80/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.56/30 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.20/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.84/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.60/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.48/31 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.22/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.86/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.62/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.50/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec beta -- ip route del 10.0.0.40/32 table ntk_from_00:16:3E:5B:78:D5
lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)

lxc exec beta -- ip route del 10.0.0.0/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.64/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.8/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.72/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.24/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.88/29 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.16/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.80/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.56/30 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.20/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.84/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.60/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.48/31 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.22/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.86/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.62/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.50/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec beta -- ip route del 10.0.0.40/32 table ntk_from_00:16:3E:FD:E2:AA
lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)

lxc exec beta -- iptables -t nat -D POSTROUTING -d 10.0.0.64/27 -j SNAT --to 10.0.0.23
lxc exec beta -- ip address del 10.0.0.23/32 dev eth1
lxc exec beta -- ip address del 10.0.0.87/32 dev eth1
lxc exec beta -- ip address del 10.0.0.63/32 dev eth1
lxc exec beta -- ip address del 10.0.0.51/32 dev eth1
lxc exec beta -- ip address del 10.0.0.41/32 dev eth1
lxc exec alfa -- ping -q -n -c 1 10.0.0.62 -W 1 &>/dev/null || (echo "alfa: errore ping 10.0.0.62"; exit 1)


echo "test completato"

