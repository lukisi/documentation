# Демон NTK - Функциональный анализ

## Роль демона ntkd
Демон *ntkd* всегда должен работать на каждом узле, который участвует в сети *Netsukuku*. Цели, которые он ставит перед собой:

 - Обнаружение соседей. Компьютер должен общаться с ними для реализации алгоритма распределенной сетевой разведки.
 - Заполнение и поддержка маршрутов *Netsukuku* в таблицах маршрутизации стека TCP/IP узла.
 - Предоставление базовых услуг для работы распределенных, факультативных или обязательных служб (например, одноранговых услуг).
 - Предоставление клиентам услугу распределенного разрешения имени *(ANDNA)*.

### Определение сети Netsukuku

Сеть *Netsukuku* автоматически формируется, когда некоторые узлы, на которых работает демон *ntkd*, связаны друг с другом любыми способами, такими как кабели, подключенные к коммутатору, или с помощью радиомодулей Wi-Fi с дистанционным зондированием. Эти узлы могут быть компьютерами или точками доступа или другими устройствами, на которых, как уже упоминалось, должен быть запущен демон *ntkd*.

Сеть существует, как сущность целого, до тех пор, пока она не будет полностью подключена, то есть при любых двух узлах существует путь, который их объединяет, состоящий из узлов, связанных друг с другом.

Первоначально сеть может формироваться постепенно. Например, могут быть созданы две небольшие сети A и B, которые связаны между собой, но без прямых связей между сетью A и сетью B. Пока они не встречаются, обе сети существуют и являются независимыми и отдельными. Но когда создается связь между узлом A и узлом B, две сети объединяются в одну сеть.

Таким же образом, если сеть отключается из-за удаления некоторых ссылок, и к ним подключены две или более группы, эти группы становятся такими же «островами», то есть независимыми и отдельными сетями.

В остальной части документа, когда мы говорим о *«сети Netsukuku»*, частью которой является n, мы ссылаемся на связанную сеть, к которой принадлежит узел n; то есть узел n напрямую связан по меньшей мере с одним другим узлом этой сети.

### Работа сети Netsukuku
Сначала узел в сети *Netsukuku* должен быть сконфигурирован с этой информацией:

Каковы сетевые интерфейсы, через которые узел подключается (или может подключаться в будущем) к другим узлам сети *Netsukuku*.
С каким именем (или именами) он хочет быть идентифицирован в сети *Netsukuku*.
Кроме того, узел должен иметь демон *ntkd*, который должен работать в фоне.

После выполнения этих требований узел является частью сети *Netsukuku*. Это означает, что он может связаться с любым другим узлом сети *Netsukuku*. Демон *ntkd* исследует сеть Netsukuku, предоставляя соответствующую информацию стеку TCP/IP S.O. и использует систему имен ANDNA для регистрации своих имен и разрешения имен других узлов.

#### Исследование сети

Демон *ntkd*, запущенный в различных узлах сети, реализует алгоритм распределенной сетевой разведки. Через него каждый узел сети *Netsukuku* собирает (и обновляет) информацию о каждом пункте назначения в сети. Пункт назначения здесь относится к адресу, фактически назначенному узлу в настоящее время, или классу адресов, в пределах которых по крайней мере один адрес назначен в настоящий момент.

Как и в Интернете, сетевые группы *Netsukuku* обращаются к классам на разных иерархических уровнях. Однако он делает это автоматизированным и более эффективным способом.
Фактически, в Интернете по-прежнему существует проблема на протяжении многих лет: размер таблицы маршрутизации каждого маршрутизатора интернет-ядра растет все быстрее и быстрее.
Стандартный протокол маршрутизации, используемый этими маршрутизаторами для управления межсоединениями между различными автономными системами, составляющими весь Интернет, - это BGP. В 2014 году количество маршрутов, которые этот протокол вставил в некоторые маршрутизаторы, превысило 500 000, что вызвало проблемы с памятью многих маршрутизаторов. В 2017 году было превышено 700 000 маршрутов.
С другой стороны, сеть *Netsukuku*, например, назначая ей IPv4-адреса класса 10.0.0.0/8, может содержать до 2<sup>22</sup> узлов (4 миллиона), и каждый узел должен хранить информацию для максимум 36 пунктов назначения.

Каждому узлу сети *Netsukuku* для каждого адресата известно количество (от 1 до максимального префикса в коде) возможных маршрутов для его достижения.

Для каждого отдельного пути узел знает шлюз, шаги, которые его составляют, и стоимость маршрута, которые могут быть выражены в разных показателях, таких как латентность или пропускная способность.

В этой документации есть другие примечания относительно исследования сети.

#### Назначение маршрутов в ядре

Программное обеспечение в пакете *Netsukuku* не заменяет стек TCP/IP, реализованный в S.O. узла. Он также не намерен взаимодействовать с библиотеками TCP/IP в S.O. через крюковые системы. Вместо этого он просто берёт на себя ответственность за управление маршрутами в таблицах маршрутизации ядра.

Это проактивный протокол маршрутизации.

Маршруты *Netsukuku* - это все необходимые маршруты для каждого отдельного узла в сети *Netsukuku* и что любой адрес в пространстве Netsukuku, который не был назначен ни одному узлу, сообщается как «недоступный».

В этой документации есть другие примечания о маршрутах, которые демон *ntkd* устанавливает в таблицах ядра, и объясняется его логика.

#### Ассоциация имен - адресов

Программный пакет *Netsukuku* предлагает механизм разрешения имен узлов под названием *ANDNA* (архитектура доменных имен *Netsukuku*).

*ANDNA* создает распределенную базу данных. В нем нет незаменимых серверов. Задачи рационально распределяются между узлами, реально присутствующими в сети в любой момент времени.
Пространство имен не структурировано иерархически, с доменами, но является плоским. Каждое имя это просто последовательность допустимых символов: если имя свободно, любой узел может зарегистрировать себя в распределенной базе данных, не подвергаясь обязательства по отношению к какому-то авторитетному лицу.
Разрешение имен также может возникать без прохождения авторизированных объектов для данного домена. Это означает, что для перегрузки не так много случаев, и использование кеширующих серверов становится менее важным, чем в доменной структуре, такой как *DNS*. По этой причине *ANDNA* очень быстро реагирует на обновления ассоциаций имен и адресов в распределенной базе данных.

В этой документации описываются различия между ANDNA и DNS, механизмы регистрации и разрешения имен.

## Модульная архитектура *ntkd*

В коде, который реализован в *ntkd*, используются независимые модули, которые мы теперь будем иллюстрировать и координировать.

### Модуль "Neighborhood" (*рус.* соседство)

Модуль *Neighborhood* обнаруживает возможные связи между текущей системой и другими системами. Он обнаруживает их и хранит. Со временем он контролирует стоимость и/или обнаруживает его исчезновение.
Кроме того, в модуле *Neighborhood* предусмотрена возможность установления связи между узлами.

Программа *ntkd* создает экземпляр *NeighborhoodManager* в начале операций. Он остается живым на протяжении всей программы.
Программа предоставляет строителю делегатов для серии операций:

Создание заглушки для вызова удаленных методов в вещательном одноадресном или по IP-адресу.
Назначьте локальные локальные ссылки на сетевые интерфейсы и задайте маршруты к локальным адресам ссылок ваших ближайших соседей. Только для основного идентификатора узла (в сетевом пространстве имен по умолчанию) и для основных идентификаторов прямых соседей.
Получите диспетчер(ы), связанный с системным идентификатором или системой.
Это работает в тандеме с внедрением в *IRpcDelegate*, *ntkd* идет в библиотеку, как будет описано в технических деталях.
Затем программа передает экземпляру *NeighborhoodManager* все сетевые интерфейсы, которыми он хочет управлять. Для каждого из них имя, MAC и делегат для измерения RTT с данной системой поблизости.

Перед завершением, *ntkd* должен вызвать метод *stop_monitor_all* для приема и управления различными сигналами *nic_address_unset*.
Затем он удалит экземпляр *NeighborhoodManager*.

Продолжение перевода следует.../The translation will continue...
